{% extends 'base.html' %}
{% load static %}
{% block title %}ë¬¸ì„œ ì—…ë¡œë“œ{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/common/doc.css' %}">
{% endblock %}

{% block content %}
<div class="doc-container">
  <div class="doc-left">
    <div class="doc-title">ğŸ“„ ë¬¸ì„œ ì—…ë¡œë“œ</div>

    <div class="doc-upload-box">
      <div class="doc-drop-area" id="doc-drop-area">
        <div style="font-size: 1.3em; margin-bottom: 8px;">ğŸ“ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
        <div style="font-size: 0.9em; color: #999;">ë˜ëŠ” í´ë¦­í•˜ì—¬ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”</div>
      </div>

      <input type="file" id="doc-file-input" style="display: none;" multiple>

      <div style="margin-top: 20px;">
        <table class="doc-upload-list-table">
          <thead>
            <tr>
              <th>íŒŒì¼ëª…</th>
              <th>ì„¤ëª…</th>
              <th>ë¶„ë¥˜(íƒœê·¸)</th>
              <th>ê³µí†µë¬¸ì„œ</th>
              <th>ì œê±°</th>
            </tr>
          </thead>
          <tbody id="doc-upload-list-tbody">
            <!-- ì—…ë¡œë“œí•  íŒŒì¼ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
          </tbody>
        </table>
      </div>

      <button id="doc-upload-btn" class="doc-upload-btn" style="display: none;">ğŸ“¤ ì—…ë¡œë“œ</button>
    </div>

    <div class="doc-file-list">
      <h3>ğŸ“‹ ë“±ë¡ëœ ë¬¸ì„œ ëª©ë¡</h3>
      <table class="doc-file-list-table">
        <thead>
          <tr>
            <th>íŒŒì¼ëª…</th>
            <th>ì„¤ëª…</th>
            <th>ë¶„ë¥˜(íƒœê·¸)</th>
            <th>ê´€ë¦¬ë¶€ì„œ</th>
            <th>ê´€ë¦¬</th>
          </tr>
        </thead>
        <tbody>
          {% for doc in core_docs %}
          <tr>
            <td>
              <a href="{% url 'common:doc_download' doc.docs_id %}" class="doc-download-link">
                ğŸ“„ {{ doc.title }}
              </a>
            </td>
            <td>{{ doc.description|default:"-" }}</td>
            <td>{{ doc.tags|default:"-" }}</td>
            <td>
              {% if doc.department %}
              {{ doc.department.department_name }}
              {% else %}
              -
              {% endif %}
            </td>
            <td>
              {% if user.department and doc.department and user.department.pk == doc.department.pk %}
              <button class="doc-edit-btn"
                onclick="openEditModal({{ doc.docs_id }}, '{{ doc.description|default:'' }}', '{{ doc.tags|default:'' }}', '{{ doc.common_doc }}')">ìˆ˜ì •</button>

              <button class="doc-delete-btn" onclick="deleteDoc({{ doc.docs_id }})">ì‚­ì œ</button>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" style="text-align: center; color: #999;">ë“±ë¡ëœ ë¬¸ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- ìˆ˜ì • ëª¨ë‹¬ -->
<div id="edit-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>ë¬¸ì„œ ì •ë³´ ìˆ˜ì •</h3>
    <form id="edit-form">
      {% csrf_token %}
      <div style="margin-bottom: 15px;">
        <label for="edit-description">ì„¤ëª…:</label>
        <textarea id="edit-description" rows="3"
          style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
      </div>
      <div style="margin-bottom: 20px;">
        <label for="edit-tags">ë¶„ë¥˜(íƒœê·¸):</label>
        <input type="text" id="edit-tags" placeholder="íƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
          style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      </div>
      <div style="margin-bottom: 20px;">
        <label for="edit-common-doc">ê³µí†µë¬¸ì„œ ì—¬ë¶€:</label>
        <input type="checkbox" id="edit-common-doc">
      </div>

      <div class="modal-buttons">
        <button type="button" class="modal-btn cancel" onclick="closeEditModal()">ì·¨ì†Œ</button>
        <button type="submit" class="modal-btn confirm">ì €ì¥</button>
      </div>
    </form>
  </div>
</div>

<!-- ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
<div id="delete-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>ë¬¸ì„œ ì‚­ì œ í™•ì¸</h3>
    <p>ì •ë§ë¡œ ì´ ë¬¸ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>ì‚­ì œëœ ë¬¸ì„œëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
    <div class="modal-buttons">
      <button type="button" class="modal-btn cancel" onclick="closeDeleteModal()">ì·¨ì†Œ</button>
      <button type="button" class="modal-btn confirm" onclick="confirmDelete()">ì‚­ì œ</button>
    </div>
  </div>
</div>

<script src="{% static 'js/common/doc.js' %}"></script>
{% endblock %}