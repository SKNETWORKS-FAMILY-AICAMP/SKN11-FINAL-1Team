{% extends 'base.html' %}
{% load static %}

{% block title %}문서 업로드{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/common/doc.css' %}">
{% endblock %}

{% block content %}
<div class="doc-container">
  <div class="doc-left">
    {# ======================== 1. 문서 업로드 ======================== #}
    <!-- 문서 업로드 영역 -->
    <div class="doc-title">문서 업로드</div>
    <div class="doc-upload-box">
      <div id="doc-drop-area" class="doc-drop-area">
        <div style="font-size:1.1em;">여기로 파일을 드래그하거나 클릭하여 선택하세요</div>
        <div style="font-size:13px; color:#aaa; margin-top:4px;">PDF, DOC, DOCX, TXT 등 다양한 문서 포맷 지원</div>
        <input type="file" id="doc-file-input" multiple style="display:none;">
      </div>
    </div>

    {# ======================== 2. 추가된 파일 ======================== #}
    <!-- 추가된 파일 목록 -->
    <div class="doc-title" style="font-size:1.1em; margin:18px 0 8px 0;">추가된 파일</div>
    <div class="doc-file-list">
      <div style="width:100%; display:flex; flex-direction:column; gap:0;">
        <table class="doc-upload-list-table" id="doc-upload-list-table">
          <thead>
            <tr><th>파일명</th><th>설명</th><th>분류(태그)</th><th>공통문서</th></tr>
          </thead>
          <tbody id="doc-upload-list-tbody"></tbody>
        </table>
        <div style="width:100%; display:flex; justify-content:flex-end;">
          <button id="doc-upload-btn" class="doc-upload-btn" style="margin-top:10px; float:none;">업로드</button>
        </div>
      </div>
    </div>

    {# ======================== 3. 등록된 파일 목록 ======================== #}
    <!-- 등록된 파일 목록 -->
    <div class="doc-title" style="font-size:1.1em; margin:18px 0 8px 0;">등록된 파일 목록</div>
    <div class="doc-file-list">
      <table class="doc-file-list-table">
        <thead>
          <tr><th>파일명</th><th>설명</th><th>분류(태그)</th><th>관리부서</th><th></th></tr>
        </thead>
        <tbody>
          {% for doc in core_docs %}
          <tr data-doc-id="{{ doc.docs_id }}">
            <td>
              {% if user.department and doc.department and user.department.pk == doc.department.pk %}
                <textarea class="doc-edit-title" rows="1">{{ doc.title }}</textarea>
              {% else %}
                {{ doc.title }}
              {% endif %}
            </td>
            <td>
              {% if user.department and doc.department and user.department.pk == doc.department.pk %}
                <textarea class="doc-edit-desc" rows="1">{{ doc.description|default:"-" }}</textarea>
              {% else %}
                {{ doc.description|default:"-" }}
              {% endif %}
            </td>
            <td>
              {% if user.department and doc.department and user.department.pk == doc.department.pk %}
                <input type="text" class="doc-edit-tags" value="{% if doc.tags %}{% for tag in doc.tags.all %}{{ tag.name }}{% if not forloop.last %},{% endif %}{% endfor %}{% endif %}" placeholder="쉼표로 구분">
              {% else %}
                {% if doc.tags %}
                  {% for tag in doc.tags.all %}
                    <span class="doc-tag">{{ tag.name }}</span>
                  {% endfor %}
                {% endif %}
              {% endif %}
            </td>
            <td>{% if doc.department %}{{ doc.department.department_name }}{% else %}-{% endif %}</td>
            <td>
              {% if user.department and doc.department and user.department.pk == doc.department.pk %}
                <button class="doc-edit-btn doc-save-btn">수정</button>
                <button class="doc-edit-btn doc-delete-btn">삭제</button>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5" style="color:#aaa; text-align:center;">등록된 문서가 없습니다.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<script src="{% static 'js/common/doc.js' %}"></script>
{% endblock %}