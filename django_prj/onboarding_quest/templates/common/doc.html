{% extends 'base.html' %}
{% load static %}
{% block title %}문서 업로드{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/common/doc.css' %}">
{% endblock %}

{% block content %}
<div class="doc-container">
  <div class="doc-left">
    <div class="doc-title">📄 문서 업로드</div>

    <div class="doc-upload-box">
      <div class="doc-drop-area" id="doc-drop-area">
        <div style="font-size: 1.3em; margin-bottom: 8px;">📁 파일을 드래그하여 업로드하세요</div>
        <div style="font-size: 0.9em; color: #999;">또는 클릭하여 파일을 선택하세요</div>
      </div>

      <input type="file" id="doc-file-input" style="display: none;" multiple>

      <div style="margin-top: 20px;">
        <table class="doc-upload-list-table">
          <thead>
            <tr>
              <th>파일명</th>
              <th>설명</th>
              <th>분류(태그)</th>
              <th>공통문서</th>
              <th>제거</th>
            </tr>
          </thead>
          <tbody id="doc-upload-list-tbody">
            <!-- 업로드할 파일 목록이 여기에 표시됩니다 -->
          </tbody>
        </table>
      </div>

      <button id="doc-upload-btn" class="doc-upload-btn" style="display: none;">📤 업로드</button>
    </div>

    <div class="doc-file-list">
      <h3>📋 등록된 문서 목록</h3>
      <table class="doc-file-list-table">
        <thead>
          <tr>
            <th>파일명</th>
            <th>설명</th>
            <th>분류(태그)</th>
            <th>관리부서</th>
            <th>관리</th>
          </tr>
        </thead>
        <tbody>
          {% for doc in core_docs %}
          <tr>
            <td>
              <a href="{% url 'common:doc_download' doc.docs_id %}" class="doc-download-link">
                📄 {{ doc.title }}
              </a>
            </td>
            <td>{{ doc.description|default:"-" }}</td>
            <td>{{ doc.tags|default:"-" }}</td>
            <td>
              {% if doc.department %}
              {{ doc.department.department_name }}
              {% else %}
              -
              {% endif %}
            </td>
            <td>
              {% if user.department and doc.department and user.department.pk == doc.department.pk %}
              <button class="doc-edit-btn"
                onclick="openEditModal({{ doc.docs_id }}, '{{ doc.description|default:'' }}', '{{ doc.tags|default:'' }}', '{{ doc.common_doc }}')">수정</button>

              <button class="doc-delete-btn" onclick="deleteDoc({{ doc.docs_id }})">삭제</button>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" style="text-align: center; color: #999;">등록된 문서가 없습니다.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- 수정 모달 -->
<div id="edit-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>문서 정보 수정</h3>
    <form id="edit-form">
      {% csrf_token %}
      <div style="margin-bottom: 15px;">
        <label for="edit-description">설명:</label>
        <textarea id="edit-description" rows="3"
          style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
      </div>
      <div style="margin-bottom: 20px;">
        <label for="edit-tags">분류(태그):</label>
        <input type="text" id="edit-tags" placeholder="태그를 입력하세요"
          style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
      </div>
      <div style="margin-bottom: 20px;">
        <label for="edit-common-doc">공통문서 여부:</label>
        <input type="checkbox" id="edit-common-doc">
      </div>

      <div class="modal-buttons">
        <button type="button" class="modal-btn cancel" onclick="closeEditModal()">취소</button>
        <button type="submit" class="modal-btn confirm">저장</button>
      </div>
    </form>
  </div>
</div>

<!-- 삭제 확인 모달 -->
<div id="delete-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>문서 삭제 확인</h3>
    <p>정말로 이 문서를 삭제하시겠습니까?<br>삭제된 문서는 복구할 수 없습니다.</p>
    <div class="modal-buttons">
      <button type="button" class="modal-btn cancel" onclick="closeDeleteModal()">취소</button>
      <button type="button" class="modal-btn confirm" onclick="confirmDelete()">삭제</button>
    </div>
  </div>
</div>

<script src="{% static 'js/common/doc.js' %}"></script>
{% endblock %}