{% extends 'base.html' %}
{% load static %}

{% block title %}태스크 목록 페이지{% endblock %}
{% block extra_head %}
<style>
.tasklist-container {
  display: flex;
  gap: 32px;
  width: 100%;
  min-height: 600px;
}
.tasklist-left {
  flex: 1;
  padding: 24px 0 24px 24px;
  background: #fafbfc;
  border-radius: 12px 0 0 12px;
  min-width: 340px;
  max-width: 500px;
  overflow-y: auto;
}
.tasklist-title {
  font-size: 1.3em;
  font-weight: bold;
  margin-bottom: 18px;
  color: #222;
}
.tasklist-search-row {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
}
.tasklist-search {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 15px;
}
.tasklist-create-btn {
  padding: 8px 18px;
  background: #ffd600;
  color: #222;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}
.task-card {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  margin-bottom: 18px;
  padding: 18px 20px 14px 20px;
  border-left: 6px solid #ffd600;
  transition: box-shadow 0.2s, border-color 0.2s;
  cursor: pointer;
  position: relative;
}
.task-card.in-progress { border-left-color: #4caf50; }
.task-card.done { border-left-color: #ffd600; background: #f6fff6; }
.task-card.selected { box-shadow: 0 0 0 3px #1976d233; border-left-color: #1976d2; }
.task-card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 17px;
  font-weight: bold;
  margin-bottom: 6px;
}
.task-title { color: #222; }
.task-xp { color: #888; font-size: 15px; display: flex; align-items: center; gap: 4px; }
.icon-trophy { width: 18px; height: 18px; vertical-align: middle; }
.task-desc { color: #555; font-size: 14px; margin-bottom: 8px; }
.task-meta-row {
  display: flex;
  gap: 10px;
  align-items: center;
  font-size: 13px;
}
.task-week { color: #666; }
.task-badge {
  padding: 2px 10px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: bold;
  color: #fff;
  display: inline-block;
}
.task-badge.green { background: #4caf50; }
.task-badge.yellow { background: #ffd600; color: #222; }

.subtask-toggle {
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  margin: 0 0 0 6px;
  font-size: 18px;
  color: #222;
  user-select: none;
}
.subtask-list {
  margin: 0 0 0 32px;
  padding: 0;
  border: 1px solid #bbb;
  border-radius: 8px;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  margin-bottom: 10px;
  display: none;
}
.subtask-list.open { display: block; }
.subtask-card {
  padding: 12px 16px 10px 16px;
  border-bottom: 1px solid #eee;
  font-size: 15px;
  cursor: pointer;
}
.subtask-card:last-child { border-bottom: none; }
.subtask-title { font-weight: bold; font-size: 15px; margin-bottom: 2px; display: block; }
.subtask-desc { color: #555; font-size: 13px; margin-bottom: 4px; }
.subtask-meta-row {
  display: flex;
  gap: 8px;
  align-items: center;
  font-size: 12px;
}
.subtask-week { color: #666; }
.subtask-badge {
  padding: 2px 8px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: bold;
  color: #fff;
  display: inline-block;
}
.subtask-badge.green { background: #4caf50; }
.subtask-badge.yellow { background: #ffd600; color: #222; }

.tasklist-right {
  flex: 2;
  background: #fff;
  border-radius: 0 16px 16px 0;
  padding: 36px 48px 32px 48px;
  min-width: 600px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 10;
}
.task-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  font-size: 26px;
  font-weight: bold;
  margin-bottom: 8px;
}
.task-detail-title { color: #222; font-size: 26px; font-weight: bold; }
.task-detail-xp { color: #888; font-size: 18px; display: flex; align-items: center; gap: 4px; font-weight: bold; }
.task-detail-desc { color: #222; font-size: 17px; margin-bottom: 12px; margin-top: 8px; }
.task-detail-meta-row {
  display: flex;
  gap: 10px;
  align-items: center;
  font-size: 15px;
  margin-bottom: 12px;
}
.task-detail-status {
  color: #fff;
  background: #4caf50;
  display: inline-block;
  padding: 6px 32px;
  border-radius: 12px;
  font-size: 17px;
  font-weight: bold;
  margin-bottom: 18px;
}
.task-detail-list ul {
  margin: 0 0 24px 0;
  padding-left: 0;
  color: #222;
  font-size: 17px;
  list-style: none;
}
.task-detail-list ul li {
  margin-bottom: 6px;
  font-weight: 500;
}
.task-detail-chat {
  margin-top: auto;
  background: #fafafa;
  border-radius: 12px;
  padding: 24px 24px 18px 24px;
  margin-top: 32px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.03);
}
.chat-message {
  margin-bottom: 14px;
  font-size: 15px;
  display: flex;
  flex-direction: column;
}
.chat-message .chat-user {
  font-weight: bold;
  color: #43a047;
  margin-bottom: 2px;
}
.chat-message.mine .chat-user { color: #1976d2; }
.chat-message .chat-text { color: #222; margin-bottom: 2px; }
.chat-message .chat-time { color: #aaa; font-size: 12px; }
.chat-input-row {
  display: flex;
  gap: 8px;
  margin-top: 18px;
}
.chat-input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 16px;
  background: #fff;
}
.chat-send-btn {
  padding: 0 24px;
  background: #ffd600;
  color: #222;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>
{% endblock %}
{% block content %}
<div class="tasklist-container">
  <!-- 좌측: 퀘스트 목록 -->
  <div class="tasklist-left" id="tasklist-left">
    <div class="tasklist-title">퀘스트 목록</div>
    <div class="tasklist-search-row">
      <input type="text" class="tasklist-search" placeholder="퀘스트 검색...">
      <button class="tasklist-create-btn">생성</button>
    </div>
    <div class="task-card in-progress selected" data-detail="0">
      <div class="task-card-header">
        <span class="task-title">회사 소개 및 조직도 이해하기</span>
        <span class="task-xp"><img src="/static/img/trophy.svg" class="icon-trophy"> 50 XP</span>
      </div>
      <div class="task-desc">회사의 비전, 미션, 조직 구조를 파악하고 팀원들과 인사하기</div>
      <div class="task-meta-row">
        <span class="task-week">1개월차 1주차</span>
        <span class="task-badge green">초급</span>
      </div>
      <div class="subtask-toggle" data-toggle="0">▼</div>
      <div class="subtask-list" id="subtask-list-0">
        <div class="subtask-card" data-detail="0-0">
          <span class="subtask-title">업무 환경 설정 및 도구 익히기</span>
          <span class="subtask-desc">개발 환경, 툴 설치, 사내 시스템 접근 안내</span>
          <div class="subtask-meta-row">
            <span class="subtask-week">1개월차 2주차</span>
            <span class="subtask-badge yellow">초급</span>
          </div>
        </div>
        <!-- 여러 개의 하위 태스크 예시 -->
        <div class="subtask-card" data-detail="0-1">
          <span class="subtask-title">코드 컨벤션 숙지</span>
          <span class="subtask-desc">팀 내 코드 스타일, 리뷰 프로세스 안내</span>
          <div class="subtask-meta-row">
            <span class="subtask-week">1개월차 2주차</span>
            <span class="subtask-badge green">초급</span>
          </div>
        </div>
      </div>
    </div>
    <div class="task-card done" data-detail="1">
      <div class="task-card-header">
        <span class="task-title">첫 번째 프로젝트 참여하기</span>
        <span class="task-xp"><img src="/static/img/trophy.svg" class="icon-trophy"> 100 XP</span>
      </div>
      <div class="task-desc">간단한 프로젝트에 참여하여 워크플로우 이해하기</div>
      <div class="task-meta-row">
        <span class="task-week">1개월차 3주차</span>
        <span class="task-badge yellow">중급</span>
      </div>
      <div class="subtask-toggle" data-toggle="1">▼</div>
      <div class="subtask-list" id="subtask-list-1">
        <div class="subtask-card" data-detail="1-0">
          <span class="subtask-title">프로젝트 환경 세팅</span>
          <span class="subtask-desc">프로젝트 저장소 클론, 의존성 설치</span>
          <div class="subtask-meta-row">
            <span class="subtask-week">1개월차 3주차</span>
            <span class="subtask-badge yellow">중급</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- 우측: 상세 정보 -->
  <div class="tasklist-right">
    <div class="task-detail-header">
      <span class="task-detail-title" id="detail-title">첫 번째 프로젝트 참여하기</span>
      <span class="task-detail-xp"><img src="/static/img/trophy.svg" class="icon-trophy"> <span id="detail-xp">100 XP</span></span>
    </div>
    <div class="task-detail-desc" id="detail-desc">간단한 프로젝트에 참여하여 워크플로우 이해하기</div>
    <div class="task-detail-meta-row">
      <span class="task-week" id="detail-week">1개월차 3주차</span>
      <span class="task-badge yellow" id="detail-badge">중급</span>
    </div>
    <div class="task-detail-status" id="detail-status">완료됨</div>
    <div class="task-detail-list" id="detail-list">
      <ul>
        <li>프로젝트 준비</li>
        <li>첫 프로젝트 진행</li>
        <li>프로젝트 결과 공유</li>
      </ul>
    </div>
    <div class="task-detail-chat">
      <div class="chat-message other">
        <span class="chat-user">채팅봇</span>
        <span class="chat-text">게시글은 4주차까지 작성되었습니다. 계속 확인 부탁드립니다.</span>
        <span class="chat-time">2025.06.25. 01:41</span>
      </div>
      <div class="chat-message mine">
        <span class="chat-user">멘토유형</span>
        <span class="chat-text">완료하였으며, 다음과제도 기대하겠습니다.</span>
        <span class="chat-time">2025.06.25. 01:45</span>
      </div>
      <div class="chat-input-row">
        <input type="text" class="chat-input" placeholder="메시지 입력...">
        <button class="chat-send-btn"><span style="font-size:20px;">💬</span></button>
      </div>
    </div>
  </div>
</div>
<script>
// 카드별 상세 데이터 샘플
const details = [
  {
    title: '회사 소개 및 조직도 이해하기',
    xp: '50 XP',
    desc: '회사의 비전, 미션, 조직 구조를 파악하고 팀원들과 인사하기',
    week: '1개월차 1주차',
    badge: { text: '초급', color: 'green' },
    status: '진행중',
    list: ['회사 소개 영상 시청', '조직도 열람', '팀원 인사'],
    subtasks: [
      {
        title: '업무 환경 설정 및 도구 익히기',
        desc: '개발 환경, 툴 설치, 사내 시스템 접근 안내',
        week: '1개월차 2주차',
        badge: { text: '초급', color: 'yellow' },
        status: '진행중',
        list: ['개발 환경 설치', '사내 시스템 계정 발급'],
      },
      {
        title: '코드 컨벤션 숙지',
        desc: '팀 내 코드 스타일, 리뷰 프로세스 안내',
        week: '1개월차 2주차',
        badge: { text: '초급', color: 'green' },
        status: '진행중',
        list: ['코딩 규칙 문서 읽기', '리뷰 예시 확인'],
      },
    ],
  },
  {
    title: '첫 번째 프로젝트 참여하기',
    xp: '100 XP',
    desc: '간단한 프로젝트에 참여하여 워크플로우 이해하기',
    week: '1개월차 3주차',
    badge: { text: '중급', color: 'yellow' },
    status: '완료됨',
    list: ['프로젝트 준비', '첫 프로젝트 진행', '프로젝트 결과 공유'],
    subtasks: [
      {
        title: '프로젝트 환경 세팅',
        desc: '프로젝트 저장소 클론, 의존성 설치',
        week: '1개월차 3주차',
        badge: { text: '중급', color: 'yellow' },
        status: '진행중',
        list: ['저장소 클론', '패키지 설치'],
      },
    ],
  },
];

// 상세 정보 업데이트 함수
function updateDetail(idx, subIdx = null) {
  let d = details[idx];
  if (subIdx !== null && d.subtasks && d.subtasks[subIdx]) {
    d = d.subtasks[subIdx];
  }
  document.getElementById('detail-title').textContent = d.title;
  document.getElementById('detail-xp').textContent = d.xp || '';
  document.getElementById('detail-desc').textContent = d.desc;
  document.getElementById('detail-week').textContent = d.week;
  document.getElementById('detail-badge').textContent = d.badge.text;
  document.getElementById('detail-badge').className = 'task-badge ' + d.badge.color;
  document.getElementById('detail-status').textContent = d.status || '';
  // 리스트
  const ul = document.createElement('ul');
  (d.list || []).forEach(item => {
    const li = document.createElement('li');
    li.textContent = item;
    ul.appendChild(li);
  });
  const listDiv = document.getElementById('detail-list');
  listDiv.innerHTML = '';
  listDiv.appendChild(ul);
}
// 카드 클릭
const cards = document.querySelectorAll('.task-card');
cards.forEach((card, idx) => {
  card.addEventListener('click', function() {
    cards.forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    updateDetail(idx);
  });
});
// 하위 태스크 토글
const toggles = document.querySelectorAll('.subtask-toggle');
toggles.forEach(toggle => {
  toggle.addEventListener('click', function(e) {
    e.stopPropagation();
    const idx = toggle.getAttribute('data-toggle');
    const list = document.getElementById('subtask-list-' + idx);
    if (list.classList.contains('open')) {
      list.classList.remove('open');
      toggle.textContent = '▼';
    } else {
      list.classList.add('open');
      toggle.textContent = '▲';
    }
  });
});
// 하위 태스크 클릭 시 상세 표시
const subtaskCards = document.querySelectorAll('.subtask-card');
subtaskCards.forEach(card => {
  card.addEventListener('click', function(e) {
    e.stopPropagation();
    const [parentIdx, subIdx] = card.getAttribute('data-detail').split('-').map(Number);
    // 상위 카드 선택 표시
    cards.forEach(c => c.classList.remove('selected'));
    cards[parentIdx].classList.add('selected');
    updateDetail(parentIdx, subIdx);
  });
});
// 최초 로딩 시 첫 번째 카드 상세 표시
updateDetail(0);
</script>
{% endblock %}
