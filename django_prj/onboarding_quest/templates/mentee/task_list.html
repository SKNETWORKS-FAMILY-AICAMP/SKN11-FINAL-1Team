{% extends 'base.html' %}
{% load static %}

{% block title %}íƒœìŠ¤í¬ ëª©ë¡ í˜ì´ì§€{% endblock %}
{% block extra_head %}
<style>
.tasklist-container {
  display: flex;
  gap: 32px;
  width: 100%;
  min-height: 600px;
}
.tasklist-left {
  flex: 1;
  padding: 24px 0 24px 24px;
  background: #fafbfc;
  border-radius: 12px 0 0 12px;
  min-width: 340px;
  max-width: 500px;
  overflow-y: auto;
  max-height: 100vh;
}
.tasklist-title {
  font-size: 1.3em;
  font-weight: bold;
  margin-bottom: 18px;
  color: #222;
}
.tasklist-search-row {
  display: flex;
  gap: 8px;
  margin-bottom: 24px;
}
.tasklist-search {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 15px;
}
.tasklist-create-btn {
  padding: 8px 18px;
  background: #ffd600;
  color: #222;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}
.tasklist-filter-btn {
  padding: 8px 18px;
  background: #e0e0e0;
  color: #222;
  border: none;
  border-radius: 6px;
  font-weight: bold;
  cursor: pointer;
}
.tasklist-filter-panel {
  background: #f7f7f7;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  padding: 14px 18px 10px 18px;
  margin-top: 4px;
  font-size: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.03);
}
.filter-group {
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 12px;
}
.filter-label {
  font-weight: bold;
  margin-right: 8px;
}
.filter-group label {
  margin-right: 8px;
  font-weight: normal;
}
.filter-dday-sort {
  background: #fff;
  border: 1px solid #bbb;
  border-radius: 4px;
  padding: 2px 8px;
  margin-left: 2px;
  cursor: pointer;
  font-size: 15px;
}
.filter-dday-sort.active {
  background: #ffd600;
  color: #222;
  border-color: #ffd600;
}
.task-card {
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  margin-bottom: 18px;
  padding: 18px 20px 14px 20px;
  border-left: 6px solid #ffd600;
  transition: box-shadow 0.2s, border-color 0.2s;
  cursor: pointer;
  position: relative;
}
.task-card.in-progress { border-left-color: #4caf50; }
.task-card.done { border-left-color: #ffd600; background: #f6fff6; }
.task-card.selected { box-shadow: 0 0 0 3px #1976d233; border-left-color: #1976d2; }
.task-card.not-started { border-left-color: #f44336; }
.task-card.review-requested { border-left-color: #ffd600; }
.task-title {
  color: #222;
}
.task-title.done {
  text-decoration: line-through;
  color: #aaa;
}
.task-title.d-day {
  margin-right: 8px;
  text-align: left;
  display: inline-block;
}
.task-card-header {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  font-size: 17px;
  font-weight: bold;
  margin-bottom: 6px;
  gap: 10px;
}
.task-xp { color: #888; font-size: 15px; display: flex; align-items: center; gap: 4px; }
.icon-trophy { width: 18px; height: 18px; vertical-align: middle; }
.task-desc { color: #555; font-size: 14px; margin-bottom: 8px; }
.task-desc-row { margin-bottom: 8px; }
.task-meta-row {
  display: flex;
  gap: 10px;
  align-items: center;
  font-size: 13px;
  margin-bottom: 4px;
}
.task-week { color: #666; }
.task-badge {
  padding: 2px 10px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: bold;
  color: #fff;
  display: inline-block;
}
.task-badge.red { background: #f44336; color: #fff; }
.task-badge.green { background: #4caf50; color: #fff; }
.task-badge.yellow { background: #ffd600 !important; color: #222 !important; }

.status-badge {
  display: inline-block;
  min-width: 60px;
  padding: 2px 12px;
  border-radius: 10px;
  font-size: 13px;
  font-weight: bold;
  color: #fff;
  margin-right: 10px;
  vertical-align: middle;
}
.status-badge.not-started { background: #888; }
.status-badge.in-progress { background: #1976d2; }
.status-badge.review-requested { background: #f44336; }
.status-badge.done { background: #43a047; }

.subtask-toggle {
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  margin: 0 0 0 6px;
  font-size: 18px;
  color: #222;
  user-select: none;
}
.subtask-list {
  margin: 0 0 0 32px;
  padding: 0;
  border: 1px solid #bbb;
  border-radius: 8px;
  background: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  margin-bottom: 10px;
  display: none;
}
.subtask-list.open { display: block; }
.subtask-card {
  padding: 12px 16px 10px 16px;
  border-bottom: 1px solid #eee;
  font-size: 15px;
  cursor: pointer;
}
.subtask-card:last-child { border-bottom: none; }
.subtask-title { font-weight: bold; font-size: 15px; margin-bottom: 2px; display: block; }
.subtask-desc { color: #555; font-size: 13px; margin-bottom: 4px; }
.subtask-meta-row {
  display: flex;
  gap: 8px;
  align-items: center;
  font-size: 12px;
}
.subtask-week { color: #666; }
.subtask-badge {
  padding: 2px 8px;
  border-radius: 8px;
  font-size: 11px;
  font-weight: bold;
  color: #fff;
  display: inline-block;
}
.subtask-badge.green { background: #4caf50; }
.subtask-badge.yellow { background: #ffd600 !important; color: #222 !important; }

.tasklist-right {
  flex: 2;
  background: #fff;
  border-radius: 0 16px 16px 0;
  padding: 36px 48px 32px 48px;
  min-width: 600px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  display: flex;
  flex-direction: column;
  position: relative;
  z-index: 10;
}
.task-detail-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  font-size: 26px;
  font-weight: bold;
  margin-bottom: 8px;
}
.task-detail-title { color: #222; font-size: 26px; font-weight: bold; }
.task-detail-xp { color: #888; font-size: 18px; display: flex; align-items: center; gap: 4px; font-weight: bold; }
.task-detail-desc { color: #222; font-size: 17px; margin-bottom: 12px; margin-top: 8px; }
.task-detail-meta-row {
  display: flex;
  gap: 14px;
  align-items: center;
  font-size: 15px;
  margin-bottom: 12px;
}
.task-detail-divider {
  border: none;
  border-top: 1.5px solid #e0e0e0;
  margin: 18px 0 24px 0;
}
.task-detail-list {
  margin: 0 0 24px 0;
  padding-left: 0;
  color: #222;
  font-size: 17px;
  list-style: none;
}
.task-detail-list ul {
  margin: 0 0 24px 0;
  padding-left: 0;
  color: #222;
  font-size: 17px;
  list-style: none;
}
.task-detail-list ul li {
  margin-bottom: 6px;
  font-weight: 500;
}
.task-detail-chat {
  margin-top: auto;
  background: #fafafa;
  border-radius: 12px;
  padding: 24px 24px 18px 24px;
  margin-top: 32px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.03);
}
.chat-message {
  margin-bottom: 14px;
  font-size: 15px;
  display: flex;
  flex-direction: column;
}
.chat-message .chat-user {
  font-weight: bold;
  color: #43a047;
  margin-bottom: 2px;
}
.chat-message.mine .chat-user { color: #1976d2; }
.chat-message .chat-text { color: #222; margin-bottom: 2px; }
.chat-message .chat-time { color: #aaa; font-size: 12px; }
.chat-input-row {
  display: flex;
  gap: 8px;
  margin-top: 18px;
}
.chat-input {
  flex: 1;
  padding: 12px 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 16px;
  background: #fff;
}
.chat-send-btn {
  padding: 0 24px;
  background: #ffd600;
  color: #222;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
</style>
{% endblock %}
{% block content %}
<div class="tasklist-container">
  <!-- ì¢Œì¸¡: í€˜ìŠ¤íŠ¸ ëª©ë¡ -->
  <div class="tasklist-left" id="tasklist-left">
    <div class="tasklist-title">Task ëª©ë¡</div>
    <div class="tasklist-search-row">
      <input type="text" class="tasklist-search" placeholder="Task ê²€ìƒ‰...">
      <button class="tasklist-filter-btn">í•„í„°</button>
    </div>
    <div class="tasklist-filter-panel" style="display:none; margin-bottom:18px;">
      <div class="filter-group">
        <span class="filter-label">ë‚œì´ë„:</span>
        <label><input type="checkbox" class="filter-diff" value="ìƒ"> ìƒ</label>
        <label><input type="checkbox" class="filter-diff" value="ì¤‘"> ì¤‘</label>
        <label><input type="checkbox" class="filter-diff" value="í•˜"> í•˜</label>
      </div>
      <div class="filter-group">
        <span class="filter-label">ìƒíƒœ:</span>
        <label><input type="checkbox" class="filter-status" value="ì§„í–‰ ì „"> ì§„í–‰ ì „</label>
        <label><input type="checkbox" class="filter-status" value="ì§„í–‰ ì¤‘"> ì§„í–‰ ì¤‘</label>
        <label><input type="checkbox" class="filter-status" value="ê²€í†  ìš”ì²­"> ê²€í† ìš”ì²­</label>
        <label><input type="checkbox" class="filter-status" value="ì™„ë£Œë¨"> ì™„ë£Œ</label>
      </div>
      <div class="filter-group">
        <span class="filter-label">D-day ì •ë ¬:</span>
        <button class="filter-dday-sort" data-order="desc">â–¼</button>
      </div>
    </div>
    <div class="task-card not-started" data-detail="0">
      <div class="task-card-header">
        <span class="status-badge not-started">ì§„í–‰ ì „</span>
        <span class="task-title d-day">ì˜¨ë³´ë”© ê°€ì´ë“œ ì½ê¸°</span>
        <span class="task-xp"><span class="icon-trophy" style="font-size:15px;">ğŸ†</span> 20 XP</span>
      </div>
      <div class="task-desc-row">
        <div class="task-desc">íšŒì‚¬ ì˜¨ë³´ë”© ê°€ì´ë“œ ë¬¸ì„œë¥¼ ì½ê³ , ê¶ê¸ˆí•œ ì ì„ ì •ë¦¬í•´ë³´ì„¸ìš”.</div>
        <div class="task-meta-row">
          <span class="task-badge yellow">í•˜</span>
          <span class="d-day-badge">D-5</span>
        </div>
      </div>
      <div class="subtask-toggle" data-toggle="0">â–¼</div>
      <div class="subtask-list" id="subtask-list-0">
        <div class="subtask-card" data-detail="0-0">
          <span class="subtask-title">ê°€ì´ë“œ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ</span>
          <span class="subtask-desc">ìµœì‹  ì˜¨ë³´ë”© ê°€ì´ë“œ PDF ë°›ê¸°</span>
          <div class="subtask-meta-row"><span class="subtask-badge yellow">í•˜</span></div>
        </div>
        <div class="subtask-card" data-detail="0-1">
          <span class="subtask-title">ì¤‘ìš” ë‚´ìš© ì •ë¦¬</span>
          <span class="subtask-desc">í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‘ì„±</span>
          <div class="subtask-meta-row"><span class="subtask-badge yellow">í•˜</span></div>
        </div>
      </div>
    </div>
    <div class="task-card in-progress selected" data-detail="1">
      <div class="task-card-header">
        <span class="status-badge in-progress">ì§„í–‰ ì¤‘</span>
        <span class="task-title d-day">íšŒì‚¬ ì†Œê°œ ë° ì¡°ì§ë„ ì´í•´í•˜ê¸°</span>
        <span class="task-xp"><span class="icon-trophy" style="font-size:15px;">ğŸ†</span> 50 XP</span>
      </div>
      <div class="task-desc-row">
        <div class="task-desc">íšŒì‚¬ ì¡°ì§ êµ¬ì¡°ì™€ ê° ë¶€ì„œ ì—­í• ì„ íŒŒì•…í•˜ê³ , íŒ€ì›ë“¤ê³¼ ì²« ì¸ì‚¬ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”.</div>
        <div class="task-meta-row">
          <span class="task-badge green">ì¤‘</span>
          <span class="d-day-badge">D-2</span>
        </div>
      </div>
      <div class="subtask-toggle" data-toggle="1">â–¼</div>
      <div class="subtask-list" id="subtask-list-1">
        <div class="subtask-card" data-detail="1-0">
          <span class="subtask-title">ì¡°ì§ë„ ì—´ëŒ</span>
          <span class="subtask-desc">ì‚¬ë‚´ ì¸íŠ¸ë¼ë„·ì—ì„œ ì¡°ì§ë„ í™•ì¸</span>
          <div class="subtask-meta-row"><span class="subtask-badge green">ì¤‘</span></div>
        </div>
        <div class="subtask-card" data-detail="1-1">
          <span class="subtask-title">íŒ€ì› ì¸ì‚¬</span>
          <span class="subtask-desc">íŒ€ ì±„íŒ…ë°©ì—ì„œ ìê¸°ì†Œê°œ ë‚¨ê¸°ê¸°</span>
          <div class="subtask-meta-row"><span class="subtask-badge green">ì¤‘</span></div>
        </div>
      </div>
    </div>
    <div class="task-card review-requested" data-detail="2">
      <div class="task-card-header">
        <span class="status-badge review-requested">ê²€í† ìš”ì²­</span>
        <span class="task-title d-day">ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ì‹¤ìŠµ</span>
        <span class="task-xp"><span class="icon-trophy" style="font-size:15px;">ğŸ†</span> 80 XP</span>
      </div>
      <div class="task-desc-row">
        <div class="task-desc">ì‹¤ì œ ê²°ì¬/ë³´ê³  í”„ë¡œì„¸ìŠ¤ë¥¼ ê²½í—˜í•˜ê³ , í”¼ë“œë°±ì„ ë°›ì•„ë³´ì„¸ìš”.</div>
        <div class="task-meta-row">
          <span class="task-badge red">ìƒ</span>
          <span class="d-day-badge">D-1</span>
        </div>
      </div>
      <div class="subtask-toggle" data-toggle="2">â–¼</div>
      <div class="subtask-list" id="subtask-list-2">
        <div class="subtask-card" data-detail="2-0">
          <span class="subtask-title">ì—…ë¬´ ìš”ì²­ì„œ ì‘ì„±</span>
          <span class="subtask-desc">ì—…ë¬´ ìš”ì²­ì„œ ì–‘ì‹ì— ë§ê²Œ ì‘ì„±</span>
          <div class="subtask-meta-row"><span class="subtask-badge red">ìƒ</span></div>
        </div>
        <div class="subtask-card" data-detail="2-1">
          <span class="subtask-title">ê²°ì¬ í”„ë¡œì„¸ìŠ¤ ê²½í—˜</span>
          <span class="subtask-desc">ê²°ì¬ ìš”ì²­ ë° ìŠ¹ì¸ ê²½í—˜</span>
          <div class="subtask-meta-row"><span class="subtask-badge red">ìƒ</span></div>
        </div>
        <div class="subtask-card" data-detail="2-2">
          <span class="subtask-title">í”¼ë“œë°± ì •ë¦¬</span>
          <span class="subtask-desc">ë©˜í†  í”¼ë“œë°± ì •ë¦¬ ë° ê°œì„ ì  ë„ì¶œ</span>
          <div class="subtask-meta-row"><span class="subtask-badge red">ìƒ</span></div>
        </div>
      </div>
    </div>
    <div class="task-card done" data-detail="3">
      <div class="task-card-header">
        <span class="status-badge done">ì™„ë£Œ</span>
        <span class="task-title d-day done">ì²« ë²ˆì§¸ í”„ë¡œì íŠ¸ ì°¸ì—¬í•˜ê¸°</span>
        <span class="task-xp"><span class="icon-trophy" style="font-size:15px;">ğŸ†</span> 100 XP</span>
      </div>
      <div class="task-desc-row">
        <div class="task-desc">íŒ€ í”„ë¡œì íŠ¸ì— ì§ì ‘ ì°¸ì—¬í•˜ì—¬ ì‹¤ë¬´ ê²½í—˜ì„ ìŒ“ê³ , ê²°ê³¼ë¥¼ ê³µìœ í•˜ì„¸ìš”.</div>
        <div class="task-meta-row">
          <span class="task-badge red">ìƒ</span>
          <span class="d-day-badge">D-DAY</span>
        </div>
      </div>
      <div class="subtask-toggle" data-toggle="3">â–¼</div>
      <div class="subtask-list" id="subtask-list-3">
        <div class="subtask-card" data-detail="3-0">
          <span class="subtask-title">í”„ë¡œì íŠ¸ í™˜ê²½ ì„¸íŒ…</span>
          <span class="subtask-desc">ì €ì¥ì†Œ í´ë¡ , íŒ¨í‚¤ì§€ ì„¤ì¹˜, ì´ˆê¸° ì„¸íŒ…</span>
          <div class="subtask-meta-row"><span class="subtask-badge red">ìƒ</span></div>
        </div>
        <div class="subtask-card" data-detail="3-1">
          <span class="subtask-title">ì²« ì»¤ë°‹ ë° PR</span>
          <span class="subtask-desc">ì²« ì»¤ë°‹ í›„ Pull Request ìƒì„±</span>
          <div class="subtask-meta-row"><span class="subtask-badge red">ìƒ</span></div>
        </div>
      </div>
    </div>
  </div>
  <!-- ìš°ì¸¡: ìƒì„¸ ì •ë³´ -->
  <div class="tasklist-right">
    <div class="task-detail-header">
      <span class="task-detail-title" id="detail-title">ì²« ë²ˆì§¸ í”„ë¡œì íŠ¸ ì°¸ì—¬í•˜ê¸°</span>
      <span class="task-detail-xp"><span class="icon-trophy" style="font-size:15px;">ğŸ†</span> <span id="detail-xp">100 XP</span></span>
    </div>
    <div class="task-detail-desc" id="detail-desc">ê°„ë‹¨í•œ í”„ë¡œì íŠ¸ì— ì°¸ì—¬í•˜ì—¬ ì›Œí¬í”Œë¡œìš° ì´í•´í•˜ê¸°</div>
    <div class="task-detail-meta-row">
      <span class="task-badge yellow" id="detail-badge">ì¤‘ê¸‰</span>
    </div>
    <hr class="task-detail-divider">
    <div class="task-detail-list" id="detail-list">
      <ul>
        <li>í”„ë¡œì íŠ¸ ì¤€ë¹„</li>
        <li>ì²« í”„ë¡œì íŠ¸ ì§„í–‰</li>
        <li>í”„ë¡œì íŠ¸ ê²°ê³¼ ê³µìœ </li>
      </ul>
    </div>
    <div class="task-detail-chat">
      <div class="chat-message other">
        <span class="chat-user">ì±„íŒ…ë´‡</span>
        <span class="chat-text">ê²Œì‹œê¸€ì€ 4ì£¼ì°¨ê¹Œì§€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ê³„ì† í™•ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</span>
        <span class="chat-time">2025.06.25. 01:41</span>
      </div>
      <div class="chat-message mine">
        <span class="chat-user">ë©˜í† ìœ í˜•</span>
        <span class="chat-text">ì™„ë£Œí•˜ì˜€ìœ¼ë©°, ë‹¤ìŒê³¼ì œë„ ê¸°ëŒ€í•˜ê² ìŠµë‹ˆë‹¤.</span>
        <span class="chat-time">2025.06.25. 01:45</span>
      </div>
      <div class="chat-input-row">
        <input type="text" class="chat-input" placeholder="ë©”ì‹œì§€ ì…ë ¥...">
        <button class="chat-send-btn"><span style="font-size:20px;">ğŸ’¬</span></button>
      </div>
    </div>
  </div>
</div>
<script>
// ì¹´ë“œë³„ ìƒì„¸ ë°ì´í„° ìƒ˜í”Œ
const details = [
  {
    title: 'ì˜¨ë³´ë”© ê°€ì´ë“œ ì½ê¸°',
    xp: '20 XP',
    desc: 'íšŒì‚¬ ì˜¨ë³´ë”© ê°€ì´ë“œ ë¬¸ì„œë¥¼ ì½ê³ , ê¶ê¸ˆí•œ ì ì„ ì •ë¦¬í•´ë³´ì„¸ìš”.',
    badge: { text: 'í•˜', color: 'yellow' },
    status: 'ì§„í–‰ ì „',
    list: ['ê°€ì´ë“œ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ', 'ì¤‘ìš” ë‚´ìš© ì •ë¦¬', 'ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ì‘ì„±'],
    subtasks: [
      {
        title: 'ê°€ì´ë“œ ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ',
        desc: 'ìµœì‹  ì˜¨ë³´ë”© ê°€ì´ë“œ PDF ë°›ê¸°',
        badge: { text: 'í•˜', color: 'yellow' },
        status: 'ì§„í–‰ ì „',
        list: [],
      },
      {
        title: 'ì¤‘ìš” ë‚´ìš© ì •ë¦¬',
        desc: 'í•µì‹¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì‘ì„±',
        badge: { text: 'í•˜', color: 'yellow' },
        status: 'ì§„í–‰ ì „',
        list: [],
      },
      {
        title: 'ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸ ì‘ì„±',
        desc: 'ê¶ê¸ˆí•œ ì ì„ 3ê°œ ì´ìƒ ì •ë¦¬',
        badge: { text: 'í•˜', color: 'yellow' },
        status: 'ì§„í–‰ ì „',
        list: [],
      },
    ],
    comments: [
      { user: 'ë©˜í† A', text: 'ê°€ì´ë“œì—ì„œ í—·ê°ˆë¦¬ëŠ” ë¶€ë¶„ ìˆìœ¼ë©´ ì§ˆë¬¸ ë‚¨ê²¨ì£¼ì„¸ìš”!', time: '2025.07.01 09:12' },
      { user: 'ë‚˜', text: 'ë„¤! ì½ê³  ê¶ê¸ˆí•œ ì  ì •ë¦¬í•´ì„œ ì˜¬ë¦´ê²Œìš”.', time: '2025.07.01 09:15' },
    ],
  },
  {
    title: 'íšŒì‚¬ ì†Œê°œ ë° ì¡°ì§ë„ ì´í•´í•˜ê¸°',
    xp: '50 XP',
    desc: 'íšŒì‚¬ ì¡°ì§ êµ¬ì¡°ì™€ ê° ë¶€ì„œ ì—­í• ì„ íŒŒì•…í•˜ê³ , íŒ€ì›ë“¤ê³¼ ì²« ì¸ì‚¬ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”.',
    badge: { text: 'ì¤‘', color: 'green' },
    status: 'ì§„í–‰ ì¤‘',
    list: ['ì¡°ì§ë„ ì—´ëŒ', 'íŒ€ì› ì¸ì‚¬', 'íšŒì‚¬ ë¹„ì „ ê³µìœ '],
    subtasks: [
      {
        title: 'ì¡°ì§ë„ ì—´ëŒ',
        desc: 'ì‚¬ë‚´ ì¸íŠ¸ë¼ë„·ì—ì„œ ì¡°ì§ë„ í™•ì¸',
        badge: { text: 'ì¤‘', color: 'green' },
        status: 'ì§„í–‰ ì¤‘',
        list: [],
      },
      {
        title: 'íŒ€ì› ì¸ì‚¬',
        desc: 'íŒ€ ì±„íŒ…ë°©ì—ì„œ ìê¸°ì†Œê°œ ë‚¨ê¸°ê¸°',
        badge: { text: 'ì¤‘', color: 'green' },
        status: 'ì§„í–‰ ì¤‘',
        list: [],
      },
    ],
    comments: [
      { user: 'íŒ€ì¥', text: 'íŒ€ ì±„íŒ…ë°©ì— ìê¸°ì†Œê°œ ë‚¨ê²¨ì£¼ì„¸ìš”~', time: '2025.07.02 10:00' },
      { user: 'ë‚˜', text: 'ë„¤! ë°©ê¸ˆ ì¸ì‚¬ ë‚¨ê²¼ìŠµë‹ˆë‹¤.', time: '2025.07.02 10:05' },
    ],
  },
  {
    title: 'ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ì‹¤ìŠµ',
    xp: '80 XP',
    desc: 'ì‹¤ì œ ê²°ì¬/ë³´ê³  í”„ë¡œì„¸ìŠ¤ë¥¼ ê²½í—˜í•˜ê³ , í”¼ë“œë°±ì„ ë°›ì•„ë³´ì„¸ìš”.',
    badge: { text: 'ìƒ', color: 'red' },
    status: 'ê²€í†  ìš”ì²­',
    list: ['ì—…ë¬´ ìš”ì²­ì„œ ì‘ì„±', 'ê²°ì¬ í”„ë¡œì„¸ìŠ¤ ê²½í—˜', 'í”¼ë“œë°± ì •ë¦¬'],
    subtasks: [
      {
        title: 'ì—…ë¬´ ìš”ì²­ì„œ ì‘ì„±',
        desc: 'ì—…ë¬´ ìš”ì²­ì„œ ì–‘ì‹ì— ë§ê²Œ ì‘ì„±',
        badge: { text: 'ìƒ', color: 'red' },
        status: 'ì§„í–‰ ì¤‘',
        list: [],
      },
      {
        title: 'ê²°ì¬ í”„ë¡œì„¸ìŠ¤ ê²½í—˜',
        desc: 'ê²°ì¬ ìš”ì²­ ë° ìŠ¹ì¸ ê²½í—˜',
        badge: { text: 'ìƒ', color: 'red' },
        status: 'ì§„í–‰ ì¤‘',
        list: [],
      },
      {
        title: 'í”¼ë“œë°± ì •ë¦¬',
        desc: 'ë©˜í†  í”¼ë“œë°± ì •ë¦¬ ë° ê°œì„ ì  ë„ì¶œ',
        badge: { text: 'ìƒ', color: 'red' },
        status: 'ì§„í–‰ ì¤‘',
        list: [],
      },
    ],
    comments: [
      { user: 'ë©˜í† B', text: 'ê²°ì¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ ì–´ë ¤ìš´ ì  ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”.', time: '2025.07.03 14:20' },
      { user: 'ë‚˜', text: 'ê²°ì¬ ìŠ¹ì¸ ì ˆì°¨ê°€ ìƒê°ë³´ë‹¤ ë³µì¡í•˜ë„¤ìš”. ì •ë¦¬í•´ì„œ ê³µìœ ë“œë¦´ê²Œìš”.', time: '2025.07.03 14:25' },
    ],
  },
  {
    title: 'ì²« ë²ˆì§¸ í”„ë¡œì íŠ¸ ì°¸ì—¬í•˜ê¸°',
    xp: '100 XP',
    desc: 'íŒ€ í”„ë¡œì íŠ¸ì— ì§ì ‘ ì°¸ì—¬í•˜ì—¬ ì‹¤ë¬´ ê²½í—˜ì„ ìŒ“ê³ , ê²°ê³¼ë¥¼ ê³µìœ í•˜ì„¸ìš”.',
    badge: { text: 'ìƒ', color: 'red' },
    status: 'ì™„ë£Œë¨',
    list: ['í”„ë¡œì íŠ¸ í™˜ê²½ ì„¸íŒ…', 'ì²« ì»¤ë°‹ ë° PR', 'ê²°ê³¼ ë°œí‘œ'],
    subtasks: [
      {
        title: 'í”„ë¡œì íŠ¸ í™˜ê²½ ì„¸íŒ…',
        desc: 'ì €ì¥ì†Œ í´ë¡ , íŒ¨í‚¤ì§€ ì„¤ì¹˜, ì´ˆê¸° ì„¸íŒ…',
        badge: { text: 'ìƒ', color: 'red' },
        status: 'ì§„í–‰ ì¤‘',
        list: [],
      },
      {
        title: 'ì²« ì»¤ë°‹ ë° PR',
        desc: 'ì²« ì»¤ë°‹ í›„ Pull Request ìƒì„±',
        badge: { text: 'ìƒ', color: 'red' },
        status: 'ì§„í–‰ ì¤‘',
        list: [],
      },
    ],
    comments: [
      { user: 'ë©˜í† C', text: 'í”„ë¡œì íŠ¸ ê²°ê³¼ ë°œí‘œ ìë£Œë„ ê¼­ ì¤€ë¹„í•´ ì£¼ì„¸ìš”!', time: '2025.07.04 17:00' },
      { user: 'ë‚˜', text: 'ë„¤, ë°œí‘œìë£Œ ì¤€ë¹„í•´ì„œ ê³µìœ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.', time: '2025.07.04 17:10' },
    ],
  },
];

// --- í•„í„°/ì •ë ¬ ê´€ë ¨ ë³€ìˆ˜ ì„ ì–¸ ë° ìœ í‹¸ í•¨ìˆ˜ ì¶”ê°€ ---
const filterDiffs = document.querySelectorAll('.filter-diff');
const filterStatuses = document.querySelectorAll('.filter-status');
const ddaySortBtn = document.querySelector('.filter-dday-sort');
const taskCardContainer = Array.from(document.querySelectorAll('.task-card'));

let ddayOrder = 'desc'; // ê¸°ë³¸ê°’

// D-day í…ìŠ¤íŠ¸ë¥¼ ìˆ«ìê°’ìœ¼ë¡œ ë³€í™˜ (D-5 â†’ 5, D-2 â†’ 2, D-1 â†’ 1, D-DAY â†’ 0)
function getDdayValue(text) {
  if (!text) return 9999;
  if (text.includes('D-DAY')) return 0;
  const match = text.match(/D-(\d+)/);
  if (match) return parseInt(match[1]);
  return 9999;
}

// ê²€ìƒ‰ í•„í„°ë§ ê¸°ëŠ¥
const searchInput = document.querySelector('.tasklist-search');
const cards = document.querySelectorAll('.task-card');
const toggles = document.querySelectorAll('.subtask-toggle');
const subtaskCards = document.querySelectorAll('.subtask-card');

searchInput.addEventListener('input', function() {
  const keyword = searchInput.value.trim().toLowerCase();
  cards.forEach((card, idx) => {
    const titleEl = card.querySelector('.task-title');
    const titleText = titleEl.textContent.toLowerCase();
    if (keyword === '' || titleText.includes(keyword)) {
      card.style.display = '';
    } else {
      card.style.display = 'none';
    }
  });
});

// ì™„ë£Œ Taskì— ì·¨ì†Œì„  ì ìš© (ì¢Œì¸¡ ëª©ë¡)
cards.forEach((card, idx) => {
  const titleEl = card.querySelector('.task-title');
  if (details[idx] && (details[idx].status === 'ì™„ë£Œë¨' || details[idx].status === 'ì™„ë£Œ')) {
    titleEl.classList.add('done');
  } else {
    titleEl.classList.remove('done');
  }
});

// ìƒì„¸ ì •ë³´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateDetail(idx, subIdx = null) {
  let d = details[idx];
  if (subIdx !== null && d.subtasks && d.subtasks[subIdx]) {
    d = d.subtasks[subIdx];
  }
  // ìƒíƒœ, D-day, ë‚œì´ë„ ë™ì  ì ìš©
  const titleEl = document.getElementById('detail-title');
  let statusMap = [
    { text: 'ì§„í–‰ ì „', color: 'not-started' },
    { text: 'ì§„í–‰ ì¤‘', color: 'in-progress' },
    { text: 'ê²€í† ìš”ì²­', color: 'review-requested' },
    { text: 'ì™„ë£Œ', color: 'done' }
  ];
  let dday = '';
  if(idx === 0) dday = 'D-5';
  else if(idx === 1) dday = 'D-2';
  else if(idx === 2) dday = 'D-1';
  else if(idx === 3) dday = 'D-DAY';
  let status = statusMap[idx];
  titleEl.innerHTML = `<span class="status-badge ${status.color}">${status.text}</span> <span class="${d.status === 'ì™„ë£Œë¨' ? 'done' : ''}">${d.title}</span>`;
  if(d.status === 'ì™„ë£Œë¨') {
    titleEl.classList.add('done');
  } else {
    titleEl.classList.remove('done');
  }
  document.getElementById('detail-xp').textContent = d.xp || '';
  document.getElementById('detail-desc').textContent = d.desc;
  // ë‚œì´ë„/ë””ë°ì´ ë©”íƒ€(ì¤‘ë³µ ìƒì„± ë°©ì§€)
  const metaRow = document.querySelector('.task-detail-meta-row');
  metaRow.innerHTML = `<span class="task-badge ${d.badge.color}" id="detail-badge">${d.badge.text}</span> <span class="d-day-badge">${dday}</span>`;
  // ë¦¬ìŠ¤íŠ¸
  const ul = document.createElement('ul');
  (d.list || []).forEach(item => {
    const li = document.createElement('li');
    li.textContent = item;
    ul.appendChild(li);
  });
  const listDiv = document.getElementById('detail-list');
  listDiv.innerHTML = '';
  listDiv.appendChild(ul);
  // ëŒ“ê¸€
  const chatDiv = document.querySelector('.task-detail-chat');
  const chatMsgs = (d.comments || []).map(c =>
    `<div class="chat-message${c.user === 'ë‚˜' ? ' mine' : ''}">
      <span class="chat-user">${c.user}</span>
      <span class="chat-text">${c.text}</span>
      <span class="chat-time">${c.time}</span>
    </div>`
  ).join('');
  chatDiv.innerHTML = chatMsgs + chatDiv.innerHTML.substring(chatDiv.innerHTML.indexOf('<div class="chat-input-row"'));
}

// ì¹´ë“œ í´ë¦­
cards.forEach((card, idx) => {
  card.addEventListener('click', function() {
    cards.forEach(c => c.classList.remove('selected'));
    card.classList.add('selected');
    updateDetail(idx);
  });
});
// í•˜ìœ„ íƒœìŠ¤í¬ í† ê¸€
toggles.forEach(toggle => {
  toggle.addEventListener('click', function(e) {
    e.stopPropagation();
    const idx = toggle.getAttribute('data-toggle');
    const list = document.getElementById('subtask-list-' + idx);
    if (list.classList.contains('open')) {
      list.classList.remove('open');
      toggle.textContent = 'â–¼';
    } else {
      list.classList.add('open');
      toggle.textContent = 'â–²';
    }
  });
});
// í•˜ìœ„ íƒœìŠ¤í¬ í´ë¦­ ì‹œ ìƒì„¸ í‘œì‹œ
subtaskCards.forEach(card => {
  card.addEventListener('click', function(e) {
    e.stopPropagation();
    const [parentIdx, subIdx] = card.getAttribute('data-detail').split('-').map(Number);
    // ìƒìœ„ ì¹´ë“œ ì„ íƒ í‘œì‹œ
    cards.forEach(c => c.classList.remove('selected'));
    cards[parentIdx].classList.add('selected');
    updateDetail(parentIdx, subIdx);
  });
});
// ìµœì´ˆ ë¡œë”© ì‹œ ì²« ë²ˆì§¸ ì¹´ë“œ ìƒì„¸ í‘œì‹œ
updateDetail(0);

// í•„í„° ë²„íŠ¼ í† ê¸€
const filterBtn = document.querySelector('.tasklist-filter-btn');
const filterPanel = document.querySelector('.tasklist-filter-panel');
filterBtn.addEventListener('click', function() {
  if (filterPanel.style.display === 'none') {
    filterPanel.style.display = 'block';
  } else {
    filterPanel.style.display = 'none';
  }
});

// í•„í„° + ê²€ìƒ‰ ë™ì‹œ ì ìš© í•¨ìˆ˜
function getFilteredSortedIdxs() {
  // í•„í„°ë§
  const diffChecked = Array.from(filterDiffs).filter(cb => cb.checked).map(cb => cb.value);
  const statusChecked = Array.from(filterStatuses).filter(cb => cb.checked).map(cb => cb.value);
  let idxs = details.map((d, i) => i);
  if (diffChecked.length > 0) {
    idxs = idxs.filter(i => diffChecked.includes(details[i].badge.text));
  }
  if (statusChecked.length > 0) {
    idxs = idxs.filter(i => statusChecked.includes(details[i].status));
  }
  // ê²€ìƒ‰
  const keyword = searchInput.value.trim().toLowerCase();
  if (keyword) {
    idxs = idxs.filter(i => details[i].title.toLowerCase().includes(keyword));
  }
  // D-day ì •ë ¬
  if (ddayOrder) {
    idxs.sort((a, b) => {
      // detailsì—ì„œ D-day ê°’ì„ ì§ì ‘ ë¹„êµ
      const ddayMap = ['D-5', 'D-2', 'D-1', 'D-DAY'];
      function getDetailDday(idx) {
        if (idx === 0) return 5;
        if (idx === 1) return 2;
        if (idx === 2) return 1;
        if (idx === 3) return 0;
        return 9999;
      }
      const aD = getDetailDday(a);
      const bD = getDetailDday(b);
      return ddayOrder === 'desc' ? aD - bD : bD - aD;
    });
  }
  return idxs;
}

function applyTaskFilterSort() {
  const idxs = getFilteredSortedIdxs();
  // ì¹´ë“œ í‘œì‹œ/ìˆ¨ê¹€
  taskCardContainer.forEach((card, i) => card.style.display = 'none');
  idxs.forEach(idx => taskCardContainer[idx].style.display = '');
  // DOM ìˆœì„œë„ ì¬ë°°ì¹˜
  renderTaskCards(idxs);
}

// ì¹´ë“œ DOMì„ idxs ìˆœì„œëŒ€ë¡œ ì¬ë°°ì¹˜í•˜ëŠ” í•¨ìˆ˜ ì¶”ê°€
function renderTaskCards(idxs) {
  const container = document.getElementById('tasklist-left');
  // ê¸°ì¡´ ì¹´ë“œë“¤ë§Œ ì¶”ì¶œ (task-card í´ë˜ìŠ¤)
  const allCards = Array.from(container.querySelectorAll('.task-card'));
  // idxs ìˆœì„œëŒ€ë¡œ append (ì¹´ë“œê°€ ìˆ¨ê²¨ì ¸ ìˆì–´ë„ ìˆœì„œ ìœ ì§€)
  idxs.forEach(idx => {
    container.appendChild(allCards[idx]);
  });
}

// ê²€ìƒ‰ ì…ë ¥ ì‹œì—ë„ í•„í„°+ì •ë ¬ ë™ì‘
searchInput.addEventListener('input', applyTaskFilterSort);
// ì²´í¬ë°•ìŠ¤/ì •ë ¬ ë²„íŠ¼ ì´ë²¤íŠ¸
[...filterDiffs, ...filterStatuses].forEach(cb => cb.addEventListener('change', applyTaskFilterSort));
ddaySortBtn.addEventListener('click', function() {
  // í† ê¸€ asc/desc
  ddayOrder = ddayOrder === 'desc' ? 'asc' : 'desc';
  ddaySortBtn.dataset.order = ddayOrder;
  ddaySortBtn.textContent = ddayOrder === 'desc' ? 'â–¼' : 'â–²';
  // ì •ë ¬ ë°©í–¥ì´ ë°”ë€” ë•Œë§ˆë‹¤ í•­ìƒ ì •ë ¬ ì ìš©
  applyTaskFilterSort();
});
// í•„í„° íŒ¨ë„ ì—´ë¦´ ë•Œë§ˆë‹¤ ì ìš©
filterBtn.addEventListener('click', applyTaskFilterSort);
// ìµœì´ˆ ë¡œë”© ì‹œì—ë„ ì ìš©
applyTaskFilterSort();
</script>
{% endblock %}
