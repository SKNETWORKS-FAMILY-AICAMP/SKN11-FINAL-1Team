{% extends 'base.html' %}
{% load static %}

{% block title %}관리자 대시보드{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'css/account/supervisor.css' %}">
{% endblock %}

{% block content %}
<h1>관리자 대시보드</h1>
<div class="dashboard" style="display:flex; gap:30px; align-items:flex-start;">
    <!-- =================== 부서 관리 영역 =================== -->
    <div style="flex:1; min-width:260px; max-width:400px;">
        {# 부서 리스트 테이블 #}
        <table style="width:100%; margin:16px 0 12px 0; border-collapse:collapse;">
            <thead>
                <tr class="table-header-row">
                    <th>부서명</th>
                </tr>
            </thead>
            <tbody>
                <tr class="{% if not selected_department_id %}selected-dept-row{% endif %}">
                    <td class="dept-cell">
                        <a href="?" class="dept-link{% if not selected_department_id %} selected{% endif %}">전체</a>
                    </td>
                </tr>
                {% for dept in departments %}
                <tr class="{% if dept.department_id == selected_department_id %}selected-dept-row{% endif %}">
                    <td class="dept-cell">
                        <a href="?dept={{ dept.department_id }}" class="dept-link{% if dept.department_id == selected_department_id %} selected{% endif %}">{{ dept.department_name }}</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="2" class="no-dept">등록된 부서가 없습니다.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- =================== 부서 등록/수정 폼 =================== -->
        <div id="dept-form-box" style="margin-top:24px; background:#f8f8f8; border-radius:10px; padding:18px 16px;">
            <h2>부서 정보</h2>
            {% if selected_department_id and dept_detail %}
            <!-- 선택된 부서 정보 표시 -->
            <div style="margin-bottom:14px; background:#f0f6ff; border-radius:8px; padding:12px 14px; border:1px solid #b6d4fe;">
                <b>부서명:</b> {{ dept_detail.department_name|default:"-" }}<br>
                <b>설명:</b> {{ dept_detail.description|default:"-" }}<br>
            </div>
            <!-- 부서 수정 폼 (DepartmentForm 사용) -->
            <form method="post" action="{% url 'account:department_update' dept_detail.department_id %}" style="margin-bottom:0;">
                {% csrf_token %}
                <div style="margin-bottom:12px;">
                    <label for="id_department_name">부서명</label><br>
                    {{ dept_form.department_name }}
                </div>
                <div style="margin-bottom:12px;">
                    <label for="id_description">설명</label><br>
                    {{ dept_form.description }}
                </div>
                <div style="display:flex; gap:8px; align-items:center;">
                    <button type="submit" class="icon-btn" title="수정 저장" style="background:#2563eb; border:none; padding:6px 10px; border-radius:5px; color:#fff; display:flex; align-items:center;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6.536-6.536a2 2 0 112.828 2.828L11.828 15.828a2 2 0 01-2.828 0L5.232 11.232a2 2 0 010-2.828L9 13z"/></svg>
                    </button>
                    <a href="{% url 'account:department_delete' dept_detail.department_id %}" class="icon-btn" title="삭제" style="background:#f87171; border:none; padding:6px 10px; border-radius:5px; color:#fff; display:flex; align-items:center;" onclick="return confirm('정말 삭제하시겠습니까?');">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                    </a>
                </div>
            </form>
            {% else %}
            <!-- 부서 등록 폼 (DepartmentForm 사용) -->
            <form method="post" action="{% url 'account:department_create' %}">
                {% csrf_token %}
                <div style="margin-bottom:12px;">
                    <label for="id_department_name">부서명</label><br>
                    {{ dept_form.department_name }}
                </div>
                <div style="margin-bottom:12px;">
                    <label for="id_description">설명</label><br>
                    {{ dept_form.description }}
                </div>
                <button type="submit" class="icon-btn" title="등록" style="background:#2563eb; border:none; padding:6px 10px; border-radius:5px; color:#fff; display:flex; align-items:center;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
            </form>
            {% endif %}
        </div>
    </div>
    <!-- =================== 유저 관리 영역 =================== -->
    <div style="flex:2; min-width:340px;">
        {# 유저 상단바 #}
        <div class="top-bar" style="display:flex; justify-content:flex-end;">
            <a href="{% url 'account:user_create' %}" class="btn">+ 신규 유저 등록</a>
        </div>
        <!-- js, css는 별도 파일로 분리 -->
        {# 유저 리스트 테이블 #}
        <table>
            <thead>
                <tr>
                    <th>사번</th>
                    <th>이름</th>
                    <th>부서</th>
                    <th>직급</th>
                    <th>입사일</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td>{{ u.employee_number }}</td>
                    <td>{{ u.last_name }}{{ u.first_name }}</td>
                    <td>{{ u.department.department_name }}</td>
                    <td>{{ u.position }}</td>
                    <td>{{ u.join_date|date:"Y-m-d" }}</td>
                    <td>
                        <a href="{% url 'account:user_update' u.pk %}" class="edit-link action-link" title="수정" style="margin-right:6px; display:inline-block; vertical-align:middle;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="vertical-align:middle;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536M9 13l6.536-6.536a2 2 0 112.828 2.828L11.828 15.828a2 2 0 01-2.828 0L5.232 11.232a2 2 0 010-2.828L9 13z"/></svg>
                        </a>
                        <a href="{% url 'account:user_delete' u.pk %}" class="delete-link action-link" title="삭제" onclick="return confirm('정말 삭제하시겠습니까?');" style="display:inline-block; vertical-align:middle;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" style="vertical-align:middle;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="6">등록된 직원이 없습니다.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
    <!-- js 파일 분리 적용 -->
{% endblock %}