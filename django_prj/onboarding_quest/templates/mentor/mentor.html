{% extends 'base.html' %}
{% load static %}

{% block title %}ë©˜í†  ëŒ€ì‹œë³´ë“œ{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/mentor/mentor.css' %}">
{% endblock %}

{% block content %}
  <div class="main-content">
    <div class="bg-white rounded-xl shadow-sm p-8 mb-8">
      <h1 class="text-3xl font-bold text-gray-800 mb-2">ì•ˆë…•í•˜ì„¸ìš” {{ request.user.last_name }}{{ request.user.first_name }}ë‹˜ ğŸŒŸ</h1>
      <p class="text-lg text-gray-600">ì˜¤ëŠ˜ë„ ë©˜í‹°ë¶„ë“¤ê³¼ í•¨ê»˜ ì„±ì¥í•˜ëŠ” ì—¬ì •ì„ ì‹œì‘í•´ë³´ì„¸ìš”</p>
    </div>

    <div class="mentor-section bg-white rounded-xl shadow-sm p-8">
      <div class="flex justify-between items-center mb-8">
        <div class="flex gap-4">
          <div class="relative">
            <input type="text" id="searchInput" placeholder="ë©˜í‹° ì´ë¦„ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”..." 
              class="pl-10 pr-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-blue-500 w-64 text-base">
            <svg class="w-5 h-5 text-gray-400 absolute left-3 top-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </div>
          <button id="searchBtn" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition-colors text-base font-medium">
            ê²€ìƒ‰
          </button>
        </div>
        
        <!-- í•„í„° ë²„íŠ¼ë“¤ -->
        <div class="flex gap-2">
          <button id="all-btn" class="filter-btn active">ì „ì²´</button>
          <button id="active-btn" class="filter-btn">í™œì„±í™”</button>
          <button id="inactive-btn" class="filter-btn">ë¹„í™œì„±í™”</button>
        </div>
      </div>

      <style>
        .filter-btn { 
          padding: 0.5rem 1.5rem; 
          border-radius: 0.5rem; 
          background: #f3f4f6; 
          color: #333; 
          font-weight: 500; 
          border: 1px solid #e5e7eb;
          transition: all 0.2s ease;
          cursor: pointer;
        }
        .filter-btn:hover {
          background: #e5e7eb;
        }
        .filter-btn.active { 
          background: #2563eb; 
          color: #fff; 
          border-color: #2563eb;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status.ongoing {
            background-color: #dcfce7;
            color: #16a34a;
        }
        
        .status.completed {
            background-color: #fee2e2;
            color: #dc2626;
        }
      </style>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="mentorshipCards">
        <!-- ë©˜í† ì‹­ ì¹´ë“œë“¤ì´ JavaScriptë¡œ ë™ì  ë¡œë“œë©ë‹ˆë‹¤ -->
      </div>
      
      <!-- ë¡œë”© ìƒíƒœ -->
      <div id="loading" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
        <p class="mt-4 text-gray-600">ë©˜í† ì‹­ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
      
      <!-- ë¹ˆ ìƒíƒœ -->
      <div id="emptyState" class="col-span-full text-center py-12" style="display: none;">
        <div class="text-gray-400 text-6xl mb-4">ğŸ“š</div>
        <h3 class="text-xl font-medium text-gray-500 mb-2">ê´€ë¦¬ ì¤‘ì¸ ë©˜í† ì‰½ì´ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-400">ìƒˆë¡œìš´ ë©˜í† ì‰½ì„ ì‹œì‘í•´ë³´ì„¸ìš”</p>
        <a href="{% url 'mentor:manage_mentee' %}" class="mt-4 inline-block bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
          ë©˜í† ì‰½ ìƒì„±í•˜ê¸°
        </a>
      </div>
      
      <!-- ì˜¤ë¥˜ ìƒíƒœ -->
      <div id="errorState" class="col-span-full text-center py-12" style="display: none;">
        <div class="text-red-400 text-6xl mb-4">âš ï¸</div>
        <h3 class="text-xl font-medium text-red-500 mb-2">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
        <p class="text-gray-400" id="errorMessage">ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
        <button onclick="loadMentorships()" class="mt-4 inline-block bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
          ë‹¤ì‹œ ì‹œë„
        </button>
      </div>
    </div>
  </div>

<script>
// ì „ì—­ ë³€ìˆ˜
let mentorId = null;
let originalMentorshipsData = []; // ì›ë³¸ ì „ì²´ ë°ì´í„°
let searchResultsData = []; // ê²€ìƒ‰ ê²°ê³¼ ë°ì´í„°
let currentFilter = 'all'; // í˜„ì¬ í™œì„±í™”ëœ í•„í„° ìƒíƒœ ì¶”ì 
let currentSearchQuery = ''; // í˜„ì¬ ê²€ìƒ‰ì–´ ì €ì¥
const FASTAPI_BASE_URL = 'http://localhost:8001';

// í˜ì´ì§€ ë¡œë“œì‹œ ë©˜í† ì‹­ ë°ì´í„° ë¡œë“œ
document.addEventListener('DOMContentLoaded', function() {
    // ì„¸ì…˜ì—ì„œ user_id ê°€ì ¸ì˜¤ê¸°
    mentorId = getMentorIdFromSession();
    console.log('ë©˜í†  ID:', mentorId);
    
    if (mentorId) {
        loadMentorships();
    } else {
        showError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    }
    
    // ê²€ìƒ‰ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    
    if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchMentees();
            }
        });
    }
    
    if (searchBtn) {
        searchBtn.addEventListener('click', searchMentees);
    }

    // í•„í„° ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    const allBtn = document.getElementById('all-btn');
    const activeBtn = document.getElementById('active-btn');
    const inactiveBtn = document.getElementById('inactive-btn');
    
    if (allBtn) {
        allBtn.addEventListener('click', () => setActiveFilter('all'));
    }
    if (activeBtn) {
        activeBtn.addEventListener('click', () => setActiveFilter('active'));
    }
    if (inactiveBtn) {
        inactiveBtn.addEventListener('click', () => setActiveFilter('inactive'));
    }
});

// ì„¸ì…˜ì—ì„œ ë©˜í†  ID ê°€ì ¸ì˜¤ê¸°
function getMentorIdFromSession() {
    // Django í…œí”Œë¦¿ì—ì„œ ì „ë‹¬ëœ ì‚¬ìš©ì ì •ë³´
    return {{ user_id|default:"null" }};
}

// FastAPIì—ì„œ ë©˜í† ì‹­ ë°ì´í„° ë¡œë“œ
async function loadMentorships() {
    try {
        showLoading(true);
        console.log('ë©˜í† ì‹­ ë¡œë”© ì‹œì‘...');
        console.log('ë©˜í†  ID:', mentorId);
        
        const url = `/fastapi/mentorship/?mentor_id=${mentorId}`;
        console.log('ìš”ì²­ URL:', url);
        
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            credentials: 'same-origin'  // CSRF í† í°ì„ ìœ„í•´ ì¶”ê°€
        });
        
        console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
        console.log('ì‘ë‹µ í—¤ë”:', response.headers);
        
        if (!response.ok) {
            const errorText = await response.text();
            console.error('ì‘ë‹µ ì˜¤ë¥˜ ë‚´ìš©:', errorText);
            throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
        }
        
        const data = await response.json();
        console.log('ë°›ì€ ë°ì´í„°:', data);
        console.log('ë°ì´í„° ìƒ˜í”Œ (ì²« ë²ˆì§¸ í•­ëª©):', data[0]);
        
        // ì›ë³¸ ë°ì´í„° ì €ì¥, ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”
        originalMentorshipsData = data;
        searchResultsData = []; // ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”
        
        // í•„í„° ì ìš©í•˜ì—¬ ë Œë”ë§
        applyCurrentFilter();
        
    } catch (error) {
        console.error('Error loading mentorships:', error);
        
        // ë” ìì„¸í•œ ì˜¤ë¥˜ ì •ë³´ ì œê³µ
        let errorMessage = 'ë©˜í† ì‹­ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        
        if (error instanceof TypeError && error.message.includes('fetch')) {
            errorMessage += ' ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
        } else if (error.message.includes('404')) {
            errorMessage += ' API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
        } else if (error.message.includes('500')) {
            errorMessage += ' ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        } else {
            errorMessage += ` (${error.message})`;
        }
        
        showError(errorMessage);
    } finally {
        showLoading(false);
    }
}

// ë©˜í‹° ì´ë¦„ í˜•ì‹ ë³€í™˜: "ë¯¼ìˆ˜ ê¹€" â†’ "ê¹€ë¯¼ìˆ˜"
function formatMenteeName(name) {
    if (!name) return '';
    
    const parts = name.trim().split(' ');
    if (parts.length >= 2) {
        // "ë¯¼ìˆ˜ ê¹€" â†’ "ê¹€ë¯¼ìˆ˜"
        const firstName = parts[0]; // ë¯¼ìˆ˜
        const lastName = parts[1];  // ê¹€
        return lastName + firstName; // ê¹€ë¯¼ìˆ˜
    }
    return name; // ê³µë°±ì´ ì—†ìœ¼ë©´ ì›ë˜ ì´ë¦„ ê·¸ëŒ€ë¡œ ë°˜í™˜
}

// ë©˜í† ì‹­ ì¹´ë“œ ë Œë”ë§
function renderMentorshipCards(mentorships) {
    const cardsContainer = document.getElementById('mentorshipCards');
    
    console.log('=== ì¹´ë“œ ë Œë”ë§ ì‹œì‘ ===');
    console.log('ë Œë”ë§í•  ë©˜í† ì‹­ ìˆ˜:', mentorships ? mentorships.length : 0);
    console.log('ë©˜í† ì‹­ ë°ì´í„°:', mentorships);
    
    if (!mentorships || mentorships.length === 0) {
        console.log('ë°ì´í„°ê°€ ì—†ì–´ì„œ ë¹ˆ ìƒíƒœ í‘œì‹œ');
        showEmptyStateWithFilter();
        return;
    }
    
    console.log('ì¹´ë“œ HTML ìƒì„± ì‹œì‘');
    const cardsHTML = mentorships.map(mentorship => {
        const progress = calculateProgress(mentorship);
        const dday = calculateDday(mentorship);
        const statusText = mentorship.is_active ? 'ì§„í–‰ì¤‘' : 'ì™„ë£Œ';
        const statusClass = mentorship.is_active ? 'ongoing' : 'completed';
        
        // ì´ë¦„ í˜•ì‹ ë³€í™˜: "ë¯¼ìˆ˜ ê¹€" â†’ "ê¹€ë¯¼ìˆ˜"
        const formattedName = formatMenteeName(mentorship.mentee_name);
        
        return `
            <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-lg transition-shadow cursor-pointer" 
                 onclick="navigateToTaskList(${mentorship.mentorship_id || mentorship.id})">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-14 h-14 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600 font-bold text-lg">${formattedName.charAt(0)}</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-xl text-gray-900 mb-1">${formattedName}</h3>
                            <div class="flex items-center gap-2">
                                <span class="status ${statusClass}">${statusText}</span>
                                ${mentorship.tags ? mentorship.tags.map(tag => 
                                    `<span class="bg-blue-50 text-blue-600 text-sm px-3 py-1.5 rounded-full font-medium">${tag}</span>`
                                ).join('') : ''}
                            </div>
                        </div>
                    </div>
                    ${dday ? `<span class="bg-red-50 text-red-600 text-base font-medium px-4 py-2 rounded-full">${dday}</span>` : ''}
                </div>
                
                <div class="flex items-center gap-4 mb-4 bg-gray-50 rounded-lg p-4">
                    <div class="flex-1">
                        <span class="text-base font-medium text-gray-600">ì»¤ë¦¬í˜ëŸ¼</span>
                        <p class="text-gray-900 font-medium text-lg">${mentorship.curriculum_title || 'ê¸°ë³¸ ì»¤ë¦¬í˜ëŸ¼'}</p>
                    </div>
                    <div class="border-l border-gray-200 pl-4">
                        <span class="text-base font-medium text-gray-600">ì´ ì£¼ì°¨</span>
                        <p class="text-gray-900 font-medium text-lg">${mentorship.total_weeks || 12}ì£¼</p>
                    </div>
                </div>

                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-base font-medium text-gray-600">ì§„ì²™ë„</span>
                        <span class="text-base font-bold text-gray-900">${progress}%</span>
                    </div>
                    <div class="bg-gray-100 rounded-full h-3">
                        <div class="bg-blue-500 h-3 rounded-full transition-all duration-300" style="width: ${progress}%"></div>
                    </div>
                </div>
            </div>
        `;
    }).join('');
    
    console.log('ìƒì„±ëœ ì¹´ë“œ HTML ê¸¸ì´:', cardsHTML.length);
    console.log('ì¹´ë“œ ì»¨í…Œì´ë„ˆ ìš”ì†Œ:', cardsContainer);
    
    cardsContainer.innerHTML = cardsHTML;
    hideAllStates();
    
    // ì¹´ë“œ ì»¨í…Œì´ë„ˆ ë‹¤ì‹œ ë³´ì´ê²Œ í•˜ê¸°
    cardsContainer.style.display = 'grid';
    
    console.log('ì¹´ë“œ ë Œë”ë§ ì™„ë£Œ, DOM ì—…ë°ì´íŠ¸ë¨');
    console.log('=== ì¹´ë“œ ë Œë”ë§ ì¢…ë£Œ ===');
}

// ì§„ì²™ë„ ê³„ì‚°
function calculateProgress(mentorship) {
    if (mentorship.completed_tasks && mentorship.total_tasks) {
        return Math.round((mentorship.completed_tasks / mentorship.total_tasks) * 100);
    }
    return 0;
}

// D-DAY ê³„ì‚°
function calculateDday(mentorship) {
    if (!mentorship.end_date) return null;
    
    const endDate = new Date(mentorship.end_date);
    const today = new Date();
    const diffTime = endDate - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays > 0) {
        return `D-${diffDays}`;
    } else if (diffDays === 0) {
        return 'D-DAY';
    } else {
        return `D+${Math.abs(diffDays)}`;
    }
}

// íƒœìŠ¤í¬ ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™
function navigateToTaskList(mentorshipId) {
    window.location.href = `/mentee/task_list/?mentorship_id=${mentorshipId}`;
}

// ìƒíƒœ ê´€ë¦¬ í•¨ìˆ˜ë“¤
function showLoading(show) {
    document.getElementById('loading').style.display = show ? 'block' : 'none';
}

function showEmptyState() {
    document.getElementById('emptyState').style.display = 'block';
    hideOtherStates(['emptyState']);
}

function showEmptyStateWithFilter() {
    const emptyStateDiv = document.getElementById('emptyState');
    const titleElement = emptyStateDiv.querySelector('h3');
    const messageElement = emptyStateDiv.querySelector('p');
    
    // í˜„ì¬ í•„í„°ì— ë”°ë¼ ë©”ì‹œì§€ ë³€ê²½
    switch (currentFilter) {
        case 'active':
            titleElement.textContent = 'í™œì„±í™”ëœ ë©˜í† ì‰½ì´ ì—†ìŠµë‹ˆë‹¤';
            messageElement.textContent = 'í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ë©˜í† ì‰½ì´ ì—†ìŠµë‹ˆë‹¤';
            break;
        case 'inactive':
            titleElement.textContent = 'ë¹„í™œì„±í™”ëœ ë©˜í† ì‰½ì´ ì—†ìŠµë‹ˆë‹¤';
            messageElement.textContent = 'ì™„ë£Œëœ ë©˜í† ì‰½ì´ ì—†ìŠµë‹ˆë‹¤';
            break;
        case 'all':
        default:
            titleElement.textContent = 'ê´€ë¦¬ ì¤‘ì¸ ë©˜í† ì‰½ì´ ì—†ìŠµë‹ˆë‹¤';
            messageElement.textContent = 'ìƒˆë¡œìš´ ë©˜í† ì‰½ì„ ì‹œì‘í•´ë³´ì„¸ìš”';
            break;
    }
    
    emptyStateDiv.style.display = 'block';
    hideOtherStates(['emptyState']);
}

function showError(message) {
    document.getElementById('errorMessage').textContent = message;
    document.getElementById('errorState').style.display = 'block';
    hideOtherStates(['errorState']);
}

function hideAllStates() {
    ['loading', 'emptyState', 'errorState'].forEach(id => {
        document.getElementById(id).style.display = 'none';
    });
}

function hideOtherStates(except) {
    ['loading', 'emptyState', 'errorState', 'mentorshipCards'].forEach(id => {
        if (!except.includes(id)) {
            document.getElementById(id).style.display = 'none';
        }
    });
}

// CSRF í† í° ê°€ì ¸ì˜¤ê¸°
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// ê²€ìƒ‰ í•¨ìˆ˜ ìˆ˜ì •
async function searchMentees() {
    const searchInput = document.getElementById('searchInput');
    const query = searchInput ? searchInput.value.trim() : '';
    
    // í˜„ì¬ ê²€ìƒ‰ì–´ ì €ì¥
    currentSearchQuery = query;
    
    if (!mentorId) {
        showError('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }
    
    // ê²€ìƒ‰ì–´ê°€ ì—†ìœ¼ë©´ ê²€ìƒ‰ ê²°ê³¼ ì´ˆê¸°í™”í•˜ê³  ë°”ë¡œ í•„í„° ì ìš©
    if (!query) {
        searchResultsData = [];
        applyCurrentFilter();
        return;
    }

    try {
        showLoading(true);
        
        // ê²€ìƒ‰ì–´ê°€ ìˆì„ ë•Œë§Œ API í˜¸ì¶œ
        const url = `/fastapi/mentorship/?mentor_id=${mentorId}&search=${encodeURIComponent(query)}`;
        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            credentials: 'same-origin'
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
        }

        // ê²€ìƒ‰ ê²°ê³¼ë¥¼ searchResultsDataì— ì €ì¥ (ì›ë³¸ ë°ì´í„° ë³´ì¡´)
        const searchResults = await response.json();
        searchResultsData = searchResults;
        
        // í•„í„° ì ìš©í•˜ì—¬ ë Œë”ë§
        applyCurrentFilter();
        
    } catch (error) {
        console.error('Error searching mentorships:', error);
        let errorMessage = 'ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        
        if (error instanceof TypeError && error.message.includes('fetch')) {
            errorMessage += ' ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
        } else {
            errorMessage += ` (${error.message})`;
        }
        
        showError(errorMessage);
    } finally {
        showLoading(false);
    }
}

// í•„í„° ì„¤ì • í•¨ìˆ˜
function setActiveFilter(filterType) {
    console.log('í•„í„° ì„¤ì •:', filterType);
    
    // í˜„ì¬ í•„í„° ìƒíƒœ ì—…ë°ì´íŠ¸
    currentFilter = filterType;
    
    // ëª¨ë“  í•„í„° ë²„íŠ¼ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // í´ë¦­ëœ ë²„íŠ¼ì— active í´ë˜ìŠ¤ ì¶”ê°€
    const clickedBtn = document.getElementById(`${filterType}-btn`);
    if (clickedBtn) {
        clickedBtn.classList.add('active');
    }
    
    // ì ˆëŒ€ ì„œë²„ì— ì¬ìš”ì²­í•˜ì§€ ì•Šê³ , í˜„ì¬ ë°ì´í„°ì—ì„œë§Œ í•„í„°ë§ ì ìš©
    console.log('í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§ë§Œ ì ìš©');
    applyCurrentFilter();
}

// í˜„ì¬ í•„í„° ì ìš© í•¨ìˆ˜
// í˜„ì¬ í•„í„° ì ìš© í•¨ìˆ˜ ìˆ˜ì •
function applyCurrentFilter() {
    console.log('=== í•„í„° ì ìš© ì‹œì‘ ===');
    console.log('í˜„ì¬ í•„í„°:', currentFilter);
    console.log('í˜„ì¬ ê²€ìƒ‰ì–´:', currentSearchQuery);
    console.log('ì›ë³¸ ë°ì´í„° ìˆ˜:', originalMentorshipsData.length);
    console.log('ê²€ìƒ‰ ê²°ê³¼ ë°ì´í„° ìˆ˜:', searchResultsData.length);
    
    // ì›ë³¸ ë°ì´í„° ìƒì„¸ ë¡œê·¸
    console.log('ì›ë³¸ ë°ì´í„° ìƒì„¸:');
    originalMentorshipsData.forEach((mentorship, index) => {
        console.log(`  ${index}: ${mentorship.mentee_name} - is_active: ${mentorship.is_active}`);
    });
    
    let baseData;
    
    // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, ì—†ìœ¼ë©´ ì›ë³¸ ì „ì²´ ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ
    if (currentSearchQuery && searchResultsData.length > 0) {
        baseData = searchResultsData; // ê²€ìƒ‰ ê²°ê³¼
        console.log('ê²€ìƒ‰ ëª¨ë“œ: ê²€ìƒ‰ ê²°ê³¼ ë°ì´í„° ì‚¬ìš©');
    } else if (!currentSearchQuery) {
        baseData = originalMentorshipsData; // ì›ë³¸ ì „ì²´ ë°ì´í„°
        console.log('ì „ì²´ ëª¨ë“œ: ì›ë³¸ ë°ì´í„° ì‚¬ìš©');
    } else {
        // ê²€ìƒ‰ì–´ëŠ” ìˆì§€ë§Œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ëŠ” ê²½ìš°
        baseData = [];
        console.log('ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ: ë¹ˆ ë°ì´í„° ì‚¬ìš©');
    }
    
    console.log('ê¸°ì¤€ ë°ì´í„° ìˆ˜:', baseData.length);
    
    let filteredData = [...baseData];

    // í™œì„±í™”/ë¹„í™œì„±í™” í•„í„° ì ìš©
    switch (currentFilter) {
        case 'active':
            // í™œì„±í™” ë²„íŠ¼: is_activeê°€ trueì¸ ê²ƒë“¤ë§Œ í‘œì‹œ
            console.log('í™œì„±í™” í•„í„° ì ìš© ì‹œì‘');
            filteredData = filteredData.filter(mentorship => {
                const isActive = mentorship.is_active === true;
                console.log(`  ë©˜í† ì‹­ ${mentorship.mentee_name}: is_active = ${mentorship.is_active}, í¬í•¨ì—¬ë¶€: ${isActive}`);
                return isActive;
            });
            console.log('í™œì„±í™” í•„í„° ì ìš© í›„ ë°ì´í„° ìˆ˜:', filteredData.length);
            break;
        case 'inactive':
            // ë¹„í™œì„±í™” ë²„íŠ¼: is_activeê°€ falseì¸ ê²ƒë“¤ë§Œ í‘œì‹œ
            console.log('ë¹„í™œì„±í™” í•„í„° ì ìš© ì‹œì‘');
            filteredData = filteredData.filter(mentorship => {
                const isInactive = mentorship.is_active === false;
                console.log(`  ë©˜í† ì‹­ ${mentorship.mentee_name}: is_active = ${mentorship.is_active}, í¬í•¨ì—¬ë¶€: ${isInactive}`);
                return isInactive;
            });
            console.log('ë¹„í™œì„±í™” í•„í„° ì ìš© í›„ ë°ì´í„° ìˆ˜:', filteredData.length);
            break;
        case 'all':
        default:
            console.log('ì „ì²´ í•„í„°: í•„í„°ë§ ì•ˆí•¨');
            break;
    }

    console.log('ìµœì¢… ë Œë”ë§í•  ë°ì´í„°:', filteredData);
    console.log('ìµœì¢… ë Œë”ë§í•  ë°ì´í„° ìˆ˜:', filteredData.length);
    console.log('=== í•„í„° ì ìš© ì™„ë£Œ ===');
    
    renderMentorshipCards(filteredData);
}


</script>
{% endblock %}