{% extends 'base.html' %}
{% load static %}

{% block title %}ë©˜í‹° ê´€ë¦¬ í˜ì´ì§€{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/mentor/manage_mentee.css' %}">
<style>
.mentee-container {
  display: flex;
  gap: 40px;
  width: 100%;
  min-height: 700px;
  margin-top: 40px;
}
.mentee-list-area {
  flex: none;
  width: 260px;
  background: #fafbfc;
  border-radius: 16px;
  padding: 32px 18px 32px 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  display: flex;
  flex-direction: column;
  height: fit-content;
}
.mentee-list-search {
  margin-bottom: 18px;
}
.mentee-list-search input {
  width: 100%;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 1em;
}
.mentee-list-ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
.mentee-list-ul li {
  margin-bottom: 8px;
}
.mentee-list-ul li:last-child { margin-bottom: 0; }
.mentee-list-ul a {
  display: block;
  padding: 10px 14px;
  border-radius: 8px;
  background: #fff;
  color: #222;
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s;
}
.mentee-list-ul a.selected, .mentee-list-ul a:hover {
  background: #ffd600;
  color: #222;
}
.mentee-profile-area {
  flex: 1 1 0;
  background: #fff;
  border-radius: 16px;
  padding: 24px 32px;
  min-width: 340px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  display: flex;
  flex-direction: column;
  align-items: center;
  height: fit-content;
}
.mentee-avatar {
  width: 80px; height: 80px;
  border-radius: 50%;
  background: #e6f9e6;
  display: flex; align-items: center; justify-content: center;
  font-size: 2.8em;
  margin-bottom: 18px;
  border: 2px solid #b2e5b2;
}
.mentee-name {
  font-size: 1.3em;
  font-weight: bold;
  margin-bottom: 6px;
}
.mentee-role {
  color: #4caf50;
  font-size: 1em;
  margin-bottom: 10px;
}
.mentee-extra {
  color: #555;
  font-size: 1em;
  background: #fafbfc;
  border-radius: 8px;
  padding: 12px 18px;
  margin-bottom: 0;
  min-width: 180px;
  text-align: center;
}
.mentoring-settings-area {
  flex: none;
  width: 320px;
  background: #fff;
  border-radius: 16px;
  padding: 32px 28px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  display: flex;
  flex-direction: column;
  height: fit-content;
}
.mentoring-settings-area h4 {
  font-size: 1.1em;
  font-weight: bold;
  margin-bottom: 18px;
}
.mentoring-settings-area label {
  font-size: 0.98em;
  font-weight: 500;
  margin-bottom: 4px;
  display: block;
}
.mentoring-settings-area input[type="text"],
.mentoring-settings-area input[type="date"],
.mentoring-settings-area select {
  width: 100%;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #ddd;
  font-size: 1em;
  margin-bottom: 14px;
}
.mentoring-settings-area button[type="submit"] {
  width: 100%;
  background: #ffd600;
  color: #222;
  border: none;
  border-radius: 8px;
  padding: 12px 0;
  font-size: 1.1em;
  font-weight: bold;
  cursor: pointer;
  margin-top: 10px;
}
.mentoring-settings-area .end-date-label {
  margin-top: 8px;
  font-size: 0.97em;
  color: #888;
}
</style>
{% endblock %}

{% block content %}
<div class="mentee-container">
  <!-- 1. ë©˜í‹°(ì‹ ì…ì‚¬ì›) ê²€ìƒ‰/ë¦¬ìŠ¤íŠ¸ -->
  <div class="mentee-list-area">
    <div class="mentee-list-search">
      <input type="text" id="mentee-search" placeholder="ì‚¬ì›ëª… ê²€ìƒ‰...">
    </div>
    <ul class="mentee-list-ul" id="mentee-list">
      <li><a href="#" class="selected" data-name="ê¹€ì‹ ì…" data-role="ë©˜í‹°" data-extra="í¬ë¶€: ë¹ ë¥¸ ì„±ì¥ê³¼ ì •ì§í•œ ì‹ ì…!">ê¹€ì‹ ì…</a></li>
      <li><a href="#" data-name="ì´ë©˜í‹°" data-role="ë©˜í‹°" data-extra="í¬ë¶€: íŒ€ì›Œí¬ì™€ ì†Œí†µì˜ ë‹¬ì¸!">ì´ë©˜í‹°</a></li>
      <li><a href="#" data-name="ë°•ì¸í„´" data-role="ì¸í„´" data-extra="í¬ë¶€: ì‹¤ë¬´ ê²½í—˜ê³¼ ë°°ì›€ì— ì§‘ì¤‘!">ë°•ì¸í„´</a></li>
      <li><a href="#" data-name="ìµœì‹ ì…" data-role="ì‹ ì…" data-extra="í¬ë¶€: ë„ì „ì •ì‹ ê³¼ ì±…ì„ê°!">ìµœì‹ ì…</a></li>
    </ul>
  </div>
  <!-- 2. ë©˜í‹° ì •ë³´ -->
  <div class="mentee-profile-area" id="mentee-profile">
    <div class="mentee-avatar" id="mentee-avatar">ğŸ‘¤</div>
    <div class="mentee-name" id="mentee-name">ê¹€ì‹ ì…</div>
    <div class="mentee-tags" id="mentee-tags" style="margin-bottom:12px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center;">
      <span class="tag bg-gray-100 text-sm px-2 py-1 rounded">#ì„±ì¥ëŸ¬</span>
      <span class="tag bg-gray-100 text-sm px-2 py-1 rounded">#ë¦¬ì•¡íŠ¸ë§ˆìŠ¤í„°</span>
      <span class="tag bg-gray-100 text-sm px-2 py-1 rounded">#ì»¤í”¼</span>
    </div>
    <div class="mentee-info-table" style="margin-top:8px; width:100%;">
      <div style="margin-bottom:10px;">
        <div class="font-bold text-sm mb-1">ì‚¬ì›ë²ˆí˜¸</div>
        <textarea id="mentee-id" class="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm" rows="1" readonly>2025001</textarea>
      </div>
      <div style="margin-bottom:10px;">
        <div class="font-bold text-sm mb-1">ë¶€ì„œ</div>
        <textarea id="mentee-dept" class="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm" rows="1" readonly>ê°œë°œíŒ€</textarea>
      </div>
      <div style="margin-bottom:10px;">
        <div class="font-bold text-sm mb-1">ì§ë¬´</div>
        <textarea id="mentee-job" class="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm" rows="1" readonly>í”„ë¡ íŠ¸ì—”ë“œ</textarea>
      </div>
      <div style="margin-bottom:10px;">
        <div class="font-bold text-sm mb-1">ì§ê¸‰</div>
        <textarea id="mentee-position" class="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm" rows="1" readonly>ì‚¬ì›</textarea>
      </div>
      <div style="margin-bottom:10px;">
        <div class="font-bold text-sm mb-1">ì…ì‚¬ì¼</div>
        <textarea id="mentee-join" class="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm" rows="1" readonly>2025-07-01</textarea>
      </div>
      <div style="margin-bottom:10px;">
        <div class="font-bold text-sm mb-1">ìê¸°ì†Œê°œ</div>
        <textarea id="mentee-intro" class="w-full bg-gray-50 border border-gray-200 rounded px-2 py-1 text-sm" rows="2" readonly>ì•ˆë…•í•˜ì„¸ìš”! ë¹ ë¥´ê²Œ ì„±ì¥í•˜ëŠ” ì‹ ì…ì…ë‹ˆë‹¤.</textarea>
      </div>
    </div>
  </div>
  <!-- 3. ë©˜í† ë§ ì„¤ì • -->
  <div class="mentoring-settings-area">
    <h4>ë©˜í† ë§ ì„¤ì •</h4>
    <form id="mentoring-form">
      {% csrf_token %}
      <label>ì„ íƒëœ ë©˜í‹°</label>
      <input type="text" id="selected-mentee" value="ê¹€ì‹ ì…" readonly>
      <label>ë©˜í† ì‰½ ì‹œì‘ì¼ì</label>
      <input type="date" id="start-date" value="2025-07-08">
      <label>ì»¤ë¦¬í˜ëŸ¼ ì„ íƒ</label>
      <select id="template-select">
        <option value="4">ê¸°ë³¸ ë©˜í† ë§ ì»¤ë¦¬í˜ëŸ¼ (4ì£¼)</option>
        <option value="6">ì‹ ì…ì‚¬ì› ì˜¨ë³´ë”© ì»¤ë¦¬í˜ëŸ¼ (6ì£¼)</option>
        <option value="8">ê¸°ìˆ  ì—­ëŸ‰ ê°•í™” ì»¤ë¦¬í˜ëŸ¼ (8ì£¼)</option>
        <option value="12">ë¦¬ë”ì‹­ ê°œë°œ ì»¤ë¦¬í˜ëŸ¼ (12ì£¼)</option>
      </select>
      <div class="end-date-label" id="end-date-label">ì¢…ë£Œì¼: 2025-08-05</div>
      <button type="submit">ìƒì„±</button>
    </form>
  </div>
</div>
<script>
// CSRF í† í° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}

function getCSRFToken() {
  // 1. Hidden inputì—ì„œ ê°€ì ¸ì˜¤ê¸°
  const hiddenInput = document.querySelector('input[name=csrfmiddlewaretoken]');
  if (hiddenInput && hiddenInput.value) {
    return hiddenInput.value;
  }
  
  // 2. Meta íƒœê·¸ì—ì„œ ê°€ì ¸ì˜¤ê¸°
  const metaTag = document.querySelector('meta[name=csrf-token]');
  if (metaTag && metaTag.content) {
    return metaTag.content;
  }
  
  // 3. ì¿ í‚¤ì—ì„œ ê°€ì ¸ì˜¤ê¸°
  const csrfCookie = getCookie('csrftoken');
  if (csrfCookie) {
    return csrfCookie;
  }
  
  return null;
}

// ì‹¤ì‹œê°„ ê²€ìƒ‰ í•„í„°ë§
const menteeSearch = document.getElementById('mentee-search');
const menteeList = document.getElementById('mentee-list');
const menteeLinks = menteeList.querySelectorAll('a');
menteeSearch.addEventListener('input', function() {
  const val = menteeSearch.value.trim();
  menteeLinks.forEach(link => {
    if (link.textContent.includes(val) || link.getAttribute('data-name').includes(val)) {
      link.parentElement.style.display = '';
    } else {
      link.parentElement.style.display = 'none';
    }
  });
});
// ë©˜í‹° ì„ íƒ ì‹œ í”„ë¡œí•„/ì„¤ì • ì—°ë™
const menteeProfile = document.getElementById('mentee-profile');
const menteeName = document.getElementById('mentee-name');
const menteeRole = document.getElementById('mentee-role');
const menteeExtra = document.getElementById('mentee-extra');
const selectedMentee = document.getElementById('selected-mentee');
menteeLinks.forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    menteeLinks.forEach(l => l.classList.remove('selected'));
    link.classList.add('selected');
    menteeName.textContent = link.getAttribute('data-name');
    selectedMentee.value = link.getAttribute('data-name');
    updateMenteeDetail(link.getAttribute('data-name'));
  });
});
// ì»¤ë¦¬í˜ëŸ¼/ì‹œì‘ì¼ ë³€ê²½ ì‹œ ì¢…ë£Œì¼ ìë™ ê³„ì‚°
const startDateInput = document.getElementById('start-date');
const templateSelect = document.getElementById('template-select');
const endDateLabel = document.getElementById('end-date-label');
function updateEndDate() {
  const start = new Date(startDateInput.value);
  const weeks = parseInt(templateSelect.value);
  if (!isNaN(start.getTime()) && weeks) {
    const end = new Date(start);
    end.setDate(end.getDate() + weeks * 7 - 1);
    const yyyy = end.getFullYear();
    const mm = String(end.getMonth() + 1).padStart(2, '0');
    const dd = String(end.getDate()).padStart(2, '0');
    endDateLabel.textContent = `ì¢…ë£Œì¼: ${yyyy}-${mm}-${dd}`;
  } else {
    endDateLabel.textContent = '';
  }
}
startDateInput.addEventListener('change', updateEndDate);
templateSelect.addEventListener('change', updateEndDate);
window.addEventListener('DOMContentLoaded', updateEndDate);
// ë©˜í‹°ë³„ ìƒì„¸ ì •ë³´ ë°ì´í„°
const menteeData = {
  'ê¹€ì‹ ì…': {
    id: '2025001', dept: 'ê°œë°œíŒ€', job: 'í”„ë¡ íŠ¸ì—”ë“œ', position: 'ì‚¬ì›', join: '2025-07-01', intro: 'ì•ˆë…•í•˜ì„¸ìš”! ë¹ ë¥´ê²Œ ì„±ì¥í•˜ëŠ” ì‹ ì…ì…ë‹ˆë‹¤.',
    tags: ['#ì„±ì¥ëŸ¬', '#ë¦¬ì•¡íŠ¸ë§ˆìŠ¤í„°', '#ì»¤í”¼']
  },
  'ì´ë©˜í‹°': {
    id: '2025002', dept: 'ì¸ì‚¬íŒ€', job: 'HR', position: 'ì£¼ì„', join: '2025-06-15', intro: 'ì†Œí†µê³¼ íŒ€ì›Œí¬ë¥¼ ì¤‘ì‹œí•˜ëŠ” ë©˜í‹°ì…ë‹ˆë‹¤.',
    tags: ['#ì†Œí†µì™•', '#ì—‘ì…€', '#ì—¬í–‰', '#ê¸ì •']
  },
  'ë°•ì¸í„´': {
    id: '2025003', dept: 'ë§ˆì¼€íŒ…', job: 'ì¸í„´', position: 'ì¸í„´', join: '2025-07-03', intro: 'ì‹¤ë¬´ ê²½í—˜ì„ ìŒ“ê³  ì‹¶ì–´ìš”!',
    tags: ['#ë§ˆì¼€íŒ…', '#ê¸ì •ì—ë„ˆì§€', '#ìœ íŠœë¸Œ', '#íŠ¸ë Œë“œ']
  },
  'ìµœì‹ ì…': {
    id: '2025004', dept: 'ê¸°íšíŒ€', job: 'ê¸°íš', position: 'ì‚¬ì›', join: '2025-07-05', intro: 'ë„ì „ì •ì‹ ê³¼ ì±…ì„ê°ì„ ê°€ì§„ ì‹ ì…ì…ë‹ˆë‹¤.',
    tags: ['#ê¸°íš', '#ì±…ì„ê°', '#ë…ì„œ', '#ë„ì „']
  }
};
const menteeId = document.getElementById('mentee-id');
const menteeDept = document.getElementById('mentee-dept');
const menteeJob = document.getElementById('mentee-job');
const menteePosition = document.getElementById('mentee-position');
const menteeJoin = document.getElementById('mentee-join');
const menteeIntro = document.getElementById('mentee-intro');
const menteeTags = document.getElementById('mentee-tags');
function updateMenteeDetail(name) {
  const d = menteeData[name];
  if (d) {
    menteeId.value = d.id;
    menteeDept.value = d.dept;
    menteeJob.value = d.job;
    menteePosition.value = d.position;
    menteeJoin.value = d.join;
    menteeIntro.value = d.intro;
    menteeRole.textContent = d.position === 'ì¸í„´' ? 'ì¸í„´' : (d.position === 'ì‚¬ì›' && d.job === 'ê¸°íš' ? 'ì‹ ì…' : 'ë©˜í‹°');
    // íƒœê·¸ ë Œë”ë§
    menteeTags.innerHTML = '';
    d.tags.forEach(tag => {
      const span = document.createElement('span');
      span.className = 'tag bg-gray-100 text-sm px-2 py-1 rounded';
      span.textContent = tag;
      menteeTags.appendChild(span);
    });
  }
}
// ë©˜í‹° ì„ íƒ ì‹œ ìƒì„¸ ì •ë³´ë„ ì—°ë™
menteeLinks.forEach(link => {
  link.addEventListener('click', function(e) {
    e.preventDefault();
    menteeLinks.forEach(l => l.classList.remove('selected'));
    link.classList.add('selected');
    menteeName.textContent = link.getAttribute('data-name');
    selectedMentee.value = link.getAttribute('data-name');
    updateMenteeDetail(link.getAttribute('data-name'));
  });
});
// ìµœì´ˆ ë¡œë“œ ì‹œ ê¸°ë³¸ ì •ë³´
window.addEventListener('DOMContentLoaded', function() {
  updateMenteeDetail('ê¹€ì‹ ì…');
  updateEndDate();
});
// ìƒì„± ë²„íŠ¼ í´ë¦­ ì‹œ mentor í˜ì´ì§€ë¡œ ì´ë™
const mentoringForm = document.getElementById('mentoring-form');
mentoringForm.addEventListener('submit', function(e) {
  e.preventDefault();
<<<<<<< Updated upstream
  window.location.href = '/mentor/';
=======
  // ì„ íƒëœ ë©˜í‹°ì˜ user_id ì¶”ì¶œ
  const selected = document.querySelector('#mentee-list a.selected');
  if (!selected) {
    alert('ë©˜í‹°ë¥¼ ì„ íƒí•˜ì„¸ìš”.');
    return;
  }
  const menteeId = selected.dataset.id;
  const startDate = document.getElementById('start-date').value;
  const templateSelect = document.getElementById('template-select');
  const curriculumId = templateSelect.value;
  // ì¢…ë£Œì¼ ê³„ì‚°: í™”ë©´ì— í‘œì‹œëœ ì¢…ë£Œì¼ í…ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œ
  const endDateLabel = document.getElementById('end-date-label');
  let endDate = '';
  if (endDateLabel && endDateLabel.textContent.includes('ì¢…ë£Œì¼:')) {
    endDate = endDateLabel.textContent.replace('ì¢…ë£Œì¼:', '').trim();
  }
  try {
    // CSRF í† í° ê°€ì ¸ì˜¤ê¸°
    const csrfToken = getCSRFToken();
    
    if (!csrfToken) {
      alert('CSRF í† í°ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    const res = await fetch('/mentor/create_mentorship/', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
      },
      body: JSON.stringify({ 
        mentee_id: menteeId, 
        start_date: startDate, 
        end_date: endDate, 
        curriculum_id: curriculumId 
      })
    });
    
    if (res.status === 403) {
      alert('CSRF í† í° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    const data = await res.json();
    if (data.success) {
      alert('ë©˜í† ì‰½ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
      window.location.href = '/mentor/';
    } else {
      alert('ìƒì„± ì‹¤íŒ¨: ' + (data.message || ''));
    }
  } catch (err) {
    console.error('ì„œë²„ ì˜¤ë¥˜:', err);
    alert('ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  }
>>>>>>> Stashed changes
});
</script>
{% endblock %}